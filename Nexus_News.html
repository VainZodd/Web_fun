<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS // GLOBAL NEWS GRID</title>
    
    <!-- External Assets: Google Fonts & Material Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />

    <!-- GSAP for High-End Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* --- CORE VARIABLES & THEME --- */
        :root {
            --primary-hue: 270;
            --bg-deep: #050505;
            --bg-dark: #0a0a0a;
            --bg-panel: rgba(20, 20, 20, 0.6);
            
            --primary: hsl(var(--primary-hue), 70%, 53%); /* Electric Violet */
            --accent: hsl(calc(var(--primary-hue) + 20), 90%, 53%); /* Neon Purple */
            --highlight: #E0B0FF;
            --alert: #FF003C;
            --success: #00F0FF;
            
            --text-main: #FFFFFF;
            --text-muted: #A0A0A0;
            
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-blur: blur(16px);
            
            --shadow-neon: 0 0 10px rgba(138, 43, 226, 0.5), 0 0 20px rgba(138, 43, 226, 0.3);
            --shadow-alert: 0 0 15px rgba(255, 0, 60, 0.6);
            
            --font-head: 'Orbitron', sans-serif;
            --font-body: 'Rajdhani', sans-serif;
            
            --ease-tech: cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow-x: hidden;
            /* Advanced Grid Background */
            background-image: 
                linear-gradient(rgba(138, 43, 226, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(138, 43, 226, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            min-height: 100vh;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }

        /* --- UTILITY CLASSES --- */
        .hidden { display: none !important; opacity: 0; }
        .flex-center { display: flex; justify-content: center; align-items: center; }
        .text-neon { text-shadow: 0 0 8px var(--primary); color: var(--highlight); }
        .text-alert { text-shadow: 0 0 8px var(--alert); color: var(--alert); }
        
        /* High-End Glassmorphism */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
            border-top: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Animations */
        @keyframes fadeInView {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 5px var(--primary); }
            50% { box-shadow: 0 0 20px var(--accent); }
            100% { box-shadow: 0 0 5px var(--primary); }
        }
        @keyframes scanline {
            0% { top: 0; }
            100% { top: 100%; }
        }
        .scanline-effect {
            position: absolute; width: 100%; height: 20px;
            background: linear-gradient(to bottom, transparent, var(--primary), transparent);
            opacity: 0.1;
            pointer-events: none;
            animation: scanline 3s linear infinite;
            z-index: 10;
        }

        .static-overlay {
            position: absolute; inset: 0;
            background: url('https://media.giphy.com/media/oEI9uWUqWMrBK/giphy.gif');
            background-size: cover;
            opacity: 0;
            pointer-events: none;
            z-index: 20;
            mix-blend-mode: screen;
        }

        /* --- APP CONTAINER --- */
        #app {
            max-width: 1200px;
            margin: 0 auto;
            padding-bottom: 90px; /* Space for nav */
            position: relative;
        }

        /* --- HEADER --- */
        .top-bar {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            position: sticky;
            top: 0;
            z-index: 50;
            background: linear-gradient(to bottom, #050505 0%, rgba(5,5,5,0.8) 80%, transparent 100%);
            backdrop-filter: blur(5px);
        }
        .brand { font-family: var(--font-head); font-weight: 900; letter-spacing: 2px; font-size: 1.5rem; }
        .brand span { color: var(--primary); }
        
        /* --- NAVIGATION (Bottom Dock) --- */
        .nav-dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            height: 70px;
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            overflow: hidden;
        }
        /* Neon Line on Top of Nav */
        .nav-dock::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            background: none;
            border: none;
            cursor: pointer;
            width: 100%;
            height: 100%;
            transition: all 0.3s var(--ease-tech);
            position: relative;
        }
        .nav-item .material-symbols-outlined { font-size: 24px; margin-bottom: 4px; transition: 0.3s; }
        .nav-item span { font-size: 10px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; }
        
        .nav-item.active { color: var(--text-main); }
        .nav-item.active .material-symbols-outlined { 
            color: var(--accent); 
            text-shadow: 0 0 10px var(--primary);
            transform: translateY(-2px);
        }
        /* Active Indicator Dot */
        .nav-item.active::after {
            content: ''; position: absolute; bottom: 8px; width: 4px; height: 4px;
            background: var(--accent); border-radius: 50%; box-shadow: 0 0 8px var(--accent);
        }

        /* --- VIEWS STRUCTURE --- */
        .view-section {
            padding: 0 20px;
            animation: fadeInView 0.6s var(--ease-tech) forwards;
        }

        /* --- DASHBOARD VIEW --- */
        .world-map-container {
            position: relative;
            height: 280px;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 30px;
            border: 1px solid rgba(138, 43, 226, 0.3);
            background: radial-gradient(circle at center, #1a0b2e 0%, #050505 100%);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
        }
        .map-bg {
            width: 100%; height: 100%;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/2000px-World_map_blank_without_borders.svg.png');
            background-size: cover;
            background-position: center;
            filter: invert(1) hue-rotate(240deg) brightness(0.6) contrast(1.2) opacity(0.5);
            mix-blend-mode: screen;
        }
        .hotspot {
            position: absolute;
            width: 8px; height: 8px;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent);
            cursor: pointer;
        }
        .hotspot::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            border: 1px solid var(--accent); border-radius: 50%;
            animation: ripple 2s infinite ease-out;
        }
        @keyframes ripple { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .news-card {
            border-radius: 12px;
            overflow: hidden;
            transition: border-color 0.3s;
            cursor: pointer;
            position: relative;
        }
        .news-card:hover {
            box-shadow: var(--shadow-neon);
            border-color: var(--primary);
        }
        .news-thumb {
            height: 160px;
            width: 100%;
            object-fit: cover;
            filter: grayscale(40%);
            transition: 0.3s;
        }
        .news-card:hover .news-thumb { filter: grayscale(0%); }
        .card-body { padding: 15px; }
        .card-cat {
            font-size: 10px; font-weight: 700; color: var(--accent);
            border: 1px solid var(--primary); padding: 2px 6px; border-radius: 4px;
            text-transform: uppercase; margin-bottom: 8px; display: inline-block;
        }
        .card-title { font-family: var(--font-head); font-size: 1.1rem; margin-bottom: 5px; line-height: 1.4; }
        .card-meta { font-size: 0.8rem; color: var(--text-muted); display: flex; justify-content: space-between; }

        /* --- DETAIL VIEW --- */
        .detail-hero {
            height: 40vh;
            width: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
            mask-image: linear-gradient(to bottom, black 60%, transparent 100%);
            margin-bottom: -80px;
        }
        .detail-content-wrapper {
            position: relative;
            z-index: 10;
            padding: 30px;
            border-radius: 24px 24px 0 0;
            margin: 0 10px;
        }
        .detail-badges { display: flex; gap: 10px; margin-bottom: 20px; }
        .glow-badge {
            background: rgba(138, 43, 226, 0.15);
            color: var(--highlight);
            border: 1px solid var(--primary);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.2);
            text-transform: uppercase;
        }
        .fab-group {
            position: absolute; top: -30px; right: 20px;
            display: flex; flex-direction: column; gap: 15px;
        }
        .fab {
            width: 50px; height: 50px;
            border-radius: 50%;
            background: #000;
            border: 1px solid var(--accent);
            color: var(--text-main);
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 15px rgba(188, 19, 254, 0.4);
            cursor: pointer;
            transition: 0.3s;
        }
        .fab:hover { background: var(--accent); transform: scale(1.1); }

        /* --- TIMELINE VIEW --- */
        .timeline-wrapper {
            position: relative;
            padding-left: 30px;
            border-left: 2px solid rgba(138, 43, 226, 0.3);
            margin-left: 20px;
        }
        .timeline-wrapper::after {
            content: ''; position: absolute; top: 0; bottom: 0; left: -1px; width: 2px;
            background: linear-gradient(to bottom, transparent, var(--accent), transparent);
            box-shadow: 0 0 15px var(--accent);
        }
        .timeline-node {
            position: relative;
            margin-bottom: 40px;
        }
        .node-dot {
            position: absolute; left: -39px; top: 15px;
            width: 16px; height: 16px;
            background: #050505;
            border: 2px solid var(--accent);
            border-radius: 50%;
            z-index: 2;
            transition: 0.3s;
        }
        .timeline-node:hover .node-dot {
            background: var(--accent);
            box-shadow: 0 0 15px var(--accent);
            transform: scale(1.3);
        }
        .time-label { font-family: var(--font-head); color: var(--primary); font-size: 0.9rem; margin-bottom: 5px; }

        /* --- LIVE VIEW --- */
        .video-player-frame {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            margin-bottom: 10px;
        }
        .player-controls {
            display: flex; gap: 8px; margin-bottom: 20px;
        }
        .ctrl-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-muted); font-family: var(--font-head); font-size: 0.6rem;
            padding: 5px 12px; cursor: pointer; transition: 0.3s; letter-spacing: 1px;
            display: flex; align-items: center; gap: 5px;
        }
        .ctrl-btn:hover { background: var(--primary); color: white; border-color: var(--accent); }
        .ctrl-btn.active { color: var(--accent); border-color: var(--accent); background: rgba(138,43,226,0.2); }
        .live-indicator {
            position: absolute; top: 15px; left: 15px;
            background: rgba(255, 0, 60, 0.8);
            color: white; padding: 4px 10px; border-radius: 4px;
            font-weight: 800; font-size: 0.8rem;
            display: flex; align-items: center; gap: 6px;
            box-shadow: 0 0 10px rgba(255, 0, 60, 0.6);
        }
        .live-dot { width: 8px; height: 8px; background: white; border-radius: 50%; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* Uplink Grid UI */
        .uplink-card {
            position: relative;
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(138, 43, 226, 0.3);
            transition: 0.3s;
            background: #000;
        }
        .uplink-card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(138, 43, 226, 0.3); }
        .uplink-card.active { border-color: var(--accent); box-shadow: 0 0 15px var(--accent); }

        .uplink-thumb { width: 100%; height: 80px; object-fit: cover; opacity: 0.6; transition: 0.3s; }
        .uplink-card:hover .uplink-thumb { opacity: 1; }

        .uplink-badge {
            position: absolute; top: 8px; left: 8px;
            background: var(--alert); color: white;
            font-size: 0.55rem; font-weight: 900; padding: 2px 5px;
            border-radius: 2px; display: flex; align-items: center; gap: 3px;
        }
        .signal-bars {
            position: absolute; bottom: 35px; right: 8px;
            display: flex; gap: 2px; align-items: flex-end;
        }
        .bar { width: 3px; background: var(--success); opacity: 0.3; }
        .bar.active { opacity: 1; }
        
        .multiview-btn {
            position: absolute; bottom: 15px; right: 15px;
            background: rgba(0,0,0,0.6); border: 1px solid var(--primary);
            color: var(--primary); padding: 5px 12px;
            font-family: var(--font-head); font-size: 0.7rem; letter-spacing: 1px;
            cursor: pointer; text-transform: uppercase;
        }
        
        .chat-hud {
            height: 300px;
            border-top: 1px solid var(--glass-border);
            position: relative;
            display: flex; flex-direction: column;
        }
        .chat-feed {
            flex: 1; overflow-y: auto; padding: 15px;
            display: flex; flex-direction: column; gap: 10px;
            /* Scroll from bottom effect handled by JS flex-end or scroll */
        }
        .chat-bubble {
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.2);
            padding: 8px 12px;
            border-radius: 12px 12px 12px 0;
            max-width: 85%;
            font-size: 0.9rem;
            animation: slideUpFade 0.4s ease-out;
            backdrop-filter: blur(4px);
        }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .chat-user { color: var(--highlight); font-weight: 700; font-size: 0.8rem; display: block; margin-bottom: 2px; }

        /* News Ticker */
        .ticker-container {
            width: 100%;
            background: rgba(138, 43, 226, 0.1);
            border-bottom: 1px solid var(--primary);
            overflow: hidden;
            white-space: nowrap;
            padding: 8px 0;
            margin-bottom: 20px;
        }
        .ticker-content {
            display: inline-block;
            padding-left: 100%;
            animation: ticker 30s linear infinite;
        }
        .ticker-item {
            display: inline-block;
            padding: 0 40px;
            font-family: var(--font-head);
            font-size: 0.9rem;
            color: var(--highlight);
        }
        @keyframes ticker {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }

        /* --- PROFILE VIEW --- */
        .profile-card {
            display: flex; align-items: center; gap: 20px; padding: 25px; margin-bottom: 25px;
        }
        .avatar-ring {
            width: 90px; height: 90px;
            border-radius: 50%;
            padding: 4px;
            border: 2px dashed var(--accent);
            position: relative;
        }
        .avatar-ring img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .status-dot {
            position: absolute; bottom: 0; right: 0; width: 16px; height: 16px;
            background: var(--success); border-radius: 50%;
            border: 3px solid var(--bg-deep);
            box-shadow: 0 0 10px var(--success);
        }
        
        /* Tech Toggles */
        .region-control {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; margin-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .tech-switch {
            position: relative; width: 50px; height: 26px;
            -webkit-appearance: none; background: #222;
            border-radius: 20px; outline: none; cursor: pointer;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
            transition: 0.4s; border: 1px solid #444;
        }
        .tech-switch:checked { background: var(--primary); border-color: var(--accent); box-shadow: 0 0 10px var(--primary); }
        .tech-switch::before {
            content: ''; position: absolute; width: 20px; height: 20px;
            border-radius: 50%; top: 2px; left: 2px;
            background: #fff; transition: 0.4s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .tech-switch:checked::before { transform: translateX(24px); }

        /* Stat Bars */
        .stat-bar-container { margin-bottom: 15px; }
        .stat-label { font-size: 0.8rem; color: var(--text-muted); display: flex; justify-content: space-between; margin-bottom: 5px; }
        .bar-track { width: 100%; height: 6px; background: #222; border-radius: 3px; overflow: hidden; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); width: 0%; transition: width 1s ease-out; box-shadow: 0 0 10px var(--primary); }

        /* --- ARCHIVE VIEW --- */
        .search-container { position: relative; margin-bottom: 25px; }
        .tech-input {
            width: 100%; padding: 15px 15px 15px 45px;
            background: rgba(0,0,0,0.5); border: 1px solid var(--primary);
            border-radius: 8px; color: white; font-family: var(--font-body); font-size: 1rem;
            outline: none; transition: 0.3s;
        }
        .tech-input:focus { box-shadow: var(--shadow-neon); border-color: var(--accent); }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--primary); }

        /* --- MODAL (Filters) --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 200; display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(10px);
        }
        .filter-content {
            width: 90%; max-width: 450px;
            background: #0a0a0a; border: 1px solid var(--primary);
            border-radius: 16px; padding: 30px;
            box-shadow: 0 0 50px rgba(138, 43, 226, 0.2);
            position: relative;
        }
        .modal-header {
            font-family: var(--font-head); font-size: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 15px; margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .tech-slider {
            -webkit-appearance: none; width: 100%; height: 4px;
            background: #333; outline: none; margin: 20px 0;
        }
        .tech-slider::-webkit-slider-thumb {
            -webkit-appearance: none; width: 20px; height: 20px;
            background: var(--accent); border-radius: 50%; cursor: pointer;
            box-shadow: 0 0 10px var(--accent); border: 2px solid #fff;
        }
        .btn-tech {
            width: 100%; padding: 15px; background: var(--primary); color: white;
            font-family: var(--font-head); font-weight: 700; border: none;
            border-radius: 8px; cursor: pointer; letter-spacing: 1px;
            transition: 0.3s; margin-top: 10px;
            text-transform: uppercase;
        }
        .btn-tech:hover { background: var(--accent); box-shadow: var(--shadow-neon); }

        /* --- PUSH NOTIFICATION --- */
        .push-notification {
            position: fixed; top: 20px; right: 20px;
            width: 320px;
            background: rgba(15, 2, 5, 0.95);
            border-left: 4px solid var(--alert);
            border-radius: 4px; padding: 15px;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8), 0 0 20px rgba(255, 0, 60, 0.2);
            backdrop-filter: blur(15px);
            display: flex; gap: 12px;
            border: 1px solid rgba(255, 0, 60, 0.1);
            border-left: 4px solid var(--alert);
            transform: translateX(120%);
            transition: transform 0.3s var(--ease-tech);
        }
        .push-notification.active { transform: translateX(0); }

        /* Glitch Effect */
        .glitch-text {
            position: relative;
            animation: glitch 2s infinite;
        }
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, #111 25%, #222 50%, #111 75%);
            background-size: 200% 100%;
            animation: skeleton-load 1.5s infinite;
        }
        @keyframes skeleton-load {
            from { background-position: 200% 0; }
            to { background-position: -200% 0; }
        }

    </style>
</head>
<body>

<!-- BOOT LOADER -->
<div id="boot-loader" style="position:fixed; inset:0; background:#000; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:var(--font-head); pointer-events: none;">
    <div id="boot-text" style="color:var(--primary); font-size:0.8rem; text-align:center; letter-spacing: 2px;">
        INITIALIZING NEURAL LINK...<br>
        <span style="color:var(--text-muted); font-size: 0.6rem;">ENCRYPTING TERMINAL...</span>
    </div>
    <div style="width:200px; height:2px; background:#111; margin-top:20px; position:relative; overflow:hidden;">
        <div id="boot-bar" style="position:absolute; inset:0; background:var(--primary); width:0%;"></div>
    </div>
</div>

<!-- APP ROOT -->
<div id="app">

    <!-- TOP HEADER -->
    <header class="top-bar">
        <div>
            <div class="brand">NEXUS<span>//</span>NEWS</div>
            <div style="font-size: 0.65rem; color: var(--text-muted); letter-spacing: 1px; margin-top: 4px; display: flex; align-items: center; gap: 8px;">
                <span id="system-status" style="color: var(--success); font-weight: 700;">● SYNC: STABLE</span>
                <span id="last-sync"></span>
            </div>
        </div>
        <button onclick="toggleFilters()" style="background:none; border:none; color:var(--primary); cursor:pointer;">
            <span class="material-symbols-outlined">tune</span>
        </button>
    </header>

    <!-- GLOBAL TICKER -->
    <div class="ticker-container" style="margin-bottom: 0; border-top: 1px solid rgba(138, 43, 226, 0.2);">
        <div class="ticker-content" id="global-ticker">
            <!-- Ticker items -->
        </div>
    </div>

    <!-- VIEW: DASHBOARD (Home) -->
    <section id="dashboard" class="view-section">
        <div class="world-map-container">
            <div class="map-bg"></div>
            <!-- Hotspots dynamically simulated -->
            <div class="hotspot" style="top: 30%; left: 25%;" onclick="loadNews(0)"></div>
            <div class="hotspot" style="top: 45%; left: 50%; animation-delay: 0.5s;" onclick="loadNews(1)"></div>
            <div class="hotspot" style="top: 60%; left: 75%; animation-delay: 1s;" onclick="loadNews(2)"></div>
            <div style="position: absolute; bottom: 15px; left: 15px; font-family: var(--font-head); font-size: 0.7rem; color: var(--text-muted); letter-spacing: 1px;">
                <span style="color:var(--success)">●</span> SYSTEM ONLINE
            </div>
        </div>

        <!-- SYSTEM CONSOLE LOGS -->
        <div class="glass-panel" style="border-radius: 12px; margin-bottom: 25px; padding: 12px; height: 120px; display: flex; flex-direction: column; overflow: hidden; border-left: 3px solid var(--primary);">
            <div style="font-family: var(--font-head); font-size: 0.6rem; color: var(--text-muted); margin-bottom: 8px; display: flex; justify-content: space-between;">
                <span>SYSTEM_CONSOLE // NEURAL_FEED</span>
                <span id="console-latency">LATENCY: 24ms</span>
            </div>
            <div id="system-console" style="flex: 1; font-family: 'Courier New', monospace; font-size: 0.7rem; color: var(--highlight); overflow-y: auto; scrollbar-width: none;">
                <!-- Logs injected -->
            </div>
        </div>

        <h3 class="text-neon" style="font-family: var(--font-head); margin-bottom: 20px;">LATEST TRANSMISSIONS</h3>
        <div class="news-grid" id="news-feed">
            <!-- News injected via JS -->
        </div>
    </section>

    <!-- VIEW: DETAIL -->
    <section id="detail" class="view-section hidden">
        <div class="detail-hero" id="detail-img"></div>
        <div class="glass-panel detail-content-wrapper">
            <div class="fab-group">
                <button id="btn-share" class="fab" onclick="shareLink()"><span class="material-symbols-outlined">share</span></button>
                <button id="btn-bookmark" class="fab" onclick="toggleBookmark()"><span class="material-symbols-outlined">bookmark</span></button>
            </div>
            
            <div class="detail-badges" id="detail-tags">
                <!-- Tags injected -->
            </div>
            
            <h1 id="detail-title" style="font-family: var(--font-head); line-height: 1.2; margin-bottom: 15px;"></h1>
            <div class="card-meta" style="margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px;">
                <span id="detail-region" class="text-neon"></span>
                <span id="detail-date"></span>
            </div>
            
            <div id="detail-text" style="line-height: 1.8; color: #ddd; font-size: 1.05rem;"></div>
            
            <button onclick="navTo('dashboard')" class="btn-tech" style="margin-top: 30px; width: auto; padding: 10px 30px;">
                <span class="material-symbols-outlined" style="vertical-align: middle; font-size: 18px;">arrow_back</span> RETURN
            </button>
            <a id="detail-link" target="_blank" class="btn-tech" style="margin-top: 30px; margin-left: 10px; width: auto; padding: 10px 30px; display: inline-flex; align-items: center; gap: 8px;">
                <span class="material-symbols-outlined">open_in_new</span> ORIGINAL REPORT
            </a>
        </div>
    </section>

    <!-- VIEW: TIMELINE -->
    <section id="timeline" class="view-section hidden">
        <h2 style="font-family: var(--font-head); margin-bottom: 30px;" class="text-neon">EVENT CHRONOLOGY</h2>
        <div class="timeline-wrapper" id="timeline-container">
            <!-- Timeline items injected -->
        </div>
    </section>

    <!-- VIEW: LIVE -->
    <section id="live" class="view-section hidden">
        <div class="ticker-container">
            <div class="ticker-content" id="live-ticker">
                <!-- Ticker items -->
            </div>
        </div>

        <div class="video-player-frame">
            <div class="scanline-effect" style="z-index: 5;"></div>
            <div id="static-noise" class="static-overlay" style="z-index: 6;"></div>

            <div id="video-container" style="width: 100%; height: 100%; pointer-events: auto;">
                <iframe id="live-video"
                        style="width: 100%; height: 100%; border: none; pointer-events: auto; opacity: 0.8;"
                        src=""
                        allow="autoplay; encrypted-media; fullscreen"
                        allowfullscreen></iframe>
            </div>

            <div class="live-indicator" style="z-index: 10;"><div class="live-dot"></div> LIVE FEED</div>
            
            <!-- Technical Overlay -->
            <div style="position: absolute; top: 15px; right: 15px; text-align: right; font-family: var(--font-head); font-size: 0.55rem; color: var(--primary); pointer-events: none;">
                <div id="link-resolution">RES: 2160p // HDR</div>
                <div id="link-bitrate">BITRATE: 45.2 Mbps</div>
                <div id="link-protocol">PROTO: NX-SECURED</div>
            </div>

            <!-- Fake UI Overlay -->
            <div style="position: absolute; bottom: 15px; left: 15px;">
                <h4 id="stream-name" style="margin: 0; font-family: var(--font-head);">INITIALIZING UPLINK...</h4>
                <span id="stream-status-label" style="font-size: 0.7rem; color: var(--success);">SIGNAL STABLE</span>
            </div>
        </div>

        <div class="player-controls">
            <button class="ctrl-btn" onclick="toggleMute(this)"><span class="material-symbols-outlined" style="font-size:14px;">volume_off</span> MUTE</button>
            <button class="ctrl-btn" onclick="toggleRec(this)"><span class="material-symbols-outlined" style="font-size:14px;">fiber_manual_record</span> REC</button>
            <button class="ctrl-btn" onclick="toggleZoom(this)"><span class="material-symbols-outlined" style="font-size:14px;">zoom_in</span> ZOOM</button>
            <button class="ctrl-btn" onclick="initInteractions()"><span class="material-symbols-outlined" style="font-size:14px;">refresh</span> SYNC</button>
        </div>

        <div style="display: flex; gap: 10px; margin-bottom: 25px;">
            <div class="glass-panel" style="flex:1; padding: 10px; text-align: center; border-radius: 8px;">
                <div style="font-family: var(--font-head); color: var(--accent); font-size: 1.2rem;" id="live-viewers">24.5K</div>
                <div style="font-size: 0.7rem; color: var(--text-muted);">WATCHING</div>
            </div>
            <div class="glass-panel" style="flex:1; padding: 10px; text-align: center; border-radius: 8px;">
                <div id="stream-signal" style="font-family: var(--font-head); color: var(--success); font-size: 1.2rem;">98%</div>
                <div style="font-size: 0.7rem; color: var(--text-muted);">SIGNAL</div>
            </div>
            <div class="glass-panel" style="flex:1; padding: 10px; text-align: center; border-radius: 8px;">
                <div id="stream-encryption" style="font-family: var(--font-head); color: var(--primary); font-size: 1.2rem;">AES</div>
                <div style="font-size: 0.7rem; color: var(--text-muted);">CRYPT</div>
            </div>
        </div>

        <h3 style="font-family: var(--font-head); margin-bottom: 15px;" class="text-neon">ACTIVE UPLINKS</h3>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 25px;" id="stream-selector">
            <!-- Dynamic Streams -->
        </div>

        <div class="glass-panel chat-hud" style="border-radius: 12px;">
            <div class="chat-feed" id="chat-container">
                <!-- Chat messages -->
            </div>
            <div id="chat-input-area" style="padding: 10px; background: rgba(0,0,0,0.3); display: flex; align-items: center;">
                <!-- Dynamic Input -->
            </div>
        </div>
    </section>

    <!-- VIEW: PROFILE -->
    <section id="profile" class="view-section hidden">
        <div id="profile-content" style="position:relative; overflow:hidden;">
            <div class="scanline-effect"></div>
            <!-- Dynamic Content -->
        </div>
    </section>

    <!-- VIEW: ARCHIVE -->
    <section id="archive" class="view-section hidden">
        <h2 style="font-family: var(--font-head); margin-bottom: 20px;">NEURAL ARCHIVE</h2>

        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <div class="glass-panel" style="flex:1; padding: 10px; border-radius: 8px; border-left: 2px solid var(--primary);">
                <div style="font-size: 0.6rem; color: var(--text-muted);">TOTAL ENTRIES</div>
                <div style="font-family: var(--font-head); color: var(--text-main);" id="archive-total">0</div>
            </div>
            <div class="glass-panel" style="flex:1; padding: 10px; border-radius: 8px; border-left: 2px solid var(--success);">
                <div style="font-size: 0.6rem; color: var(--text-muted);">INDEX STATUS</div>
                <div style="font-family: var(--font-head); color: var(--success);">OPTIMIZED</div>
            </div>
        </div>

        <!-- SECTOR ANALYSIS CHARTS -->
        <div class="glass-panel" style="padding: 15px; border-radius: 12px; margin-bottom: 20px;">
            <div style="font-family: var(--font-head); font-size: 0.7rem; color: var(--text-muted); margin-bottom: 12px; letter-spacing: 1px;">SECTOR ANALYSIS // DATA_DISTRIBUTION</div>
            <div id="archive-stats-viz" style="display: flex; flex-direction: column; gap: 8px;">
                <!-- Charts injected -->
            </div>
        </div>

        <div class="search-container">
            <span class="material-symbols-outlined search-icon">search</span>
            <input type="text" class="tech-input" id="archive-search" placeholder="QUERY DATABASE...">
        </div>

        <!-- CATEGORY PILLS -->
        <div id="archive-filters" style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 5px; scrollbar-width: none;">
            <!-- Pills injected -->
        </div>
        
        <div class="news-grid" id="archive-feed">
            <!-- News items -->
        </div>
    </section>

    <!-- MODAL: FILTERS -->
    <div id="filter-modal" class="modal-overlay hidden">
        <div class="filter-content glass-panel">
            <div class="modal-header">
                ADVANCED FILTERS
                <button onclick="toggleFilters()" style="background:none; border:none; color:white; cursor:pointer;"><span class="material-symbols-outlined">close</span></button>
            </div>
            
            <label style="color: var(--text-muted); font-size: 0.8rem;">TIMEFRAME SCAN</label>
            <input type="range" class="tech-slider" min="0" max="100">
            
            <label style="color: var(--text-muted); font-size: 0.8rem; display:block; margin-top: 20px;">DATA TYPE</label>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="glow-badge" style="background: var(--primary); color: white;">HOLOGRAM</button>
                <button class="glow-badge" style="background: transparent;">TEXT</button>
            </div>

            <button class="btn-tech" onclick="toggleFilters()">INITIATE FILTER</button>
        </div>
    </div>

    <!-- MODAL: AUTH -->
    <div id="auth-modal" class="modal-overlay hidden">
        <div class="filter-content glass-panel" style="max-width: 380px;">
            <div class="modal-header">
                NEXUS ACCESS
                <button onclick="toggleAuthModal()" style="background:none; border:none; color:white; cursor:pointer;"><span class="material-symbols-outlined">close</span></button>
            </div>

            <div id="auth-form">
                <div id="auth-status" style="font-family: var(--font-head); font-size: 0.7rem; text-align: center; margin-bottom: 15px; min-height: 1.2em; letter-spacing: 1px;"></div>
                <div style="margin-bottom: 20px;">
                    <label style="color: var(--text-muted); font-size: 0.8rem; display:block; margin-bottom:8px;">ID IDENTIFIER</label>
                    <input type="text" id="auth-username" class="tech-input" placeholder="USER_ID..." style="padding-left:15px;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="color: var(--text-muted); font-size: 0.8rem; display:block; margin-bottom:8px;">ACCESS KEY</label>
                    <input type="password" id="auth-password" class="tech-input" placeholder="••••••••" style="padding-left:15px;">
                </div>
                <button class="btn-tech" id="auth-submit-btn" onclick="handleAuthSubmit()">INITIALIZE SESSION</button>
                <div style="display:flex; justify-content:center; gap:20px; margin-top:15px;">
                    <button onclick="toggleAuthMode()" style="background:none; border:none; color:var(--primary); font-size:0.75rem; cursor:pointer; text-decoration:underline;" id="auth-toggle-btn">SWITCH TO REGISTRATION</button>
                </div>
                <p style="text-align:center; font-size:0.7rem; color:var(--text-muted); margin-top:15px;">SECURE NEURAL LINK ENCRYPTED</p>
            </div>
        </div>
    </div>

    <!-- PUSH NOTIFICATION: BREAKING NEWS -->
    <div id="push-notification" class="push-notification hidden">
        <div style="color: var(--alert);"><span class="material-symbols-outlined glitch-text">warning</span></div>
        <div style="flex: 1;">
            <div style="font-family: var(--font-head); font-size: 0.65rem; color: var(--alert); letter-spacing: 2px; margin-bottom: 4px; font-weight: 700;">BREAKING NEWS</div>
            <h4 id="push-title" style="margin: 0 0 8px 0; font-size: 0.9rem; line-height: 1.3;"></h4>
            <div style="display: flex; gap: 8px;">
                <button class="btn-tech" style="padding: 4px 12px; font-size: 0.65rem; width: auto; margin-top: 0;" onclick="loadDetail(currentBreakingId); closePush();">VIEW</button>
                <button onclick="closePush()" style="background:none; border:none; color:var(--text-muted); font-size: 0.65rem; cursor:pointer; text-decoration: underline;">DISMISS</button>
            </div>
        </div>
    </div>

</div> <!-- END APP -->

<!-- NAVIGATION BOTTOM DOCK -->
<nav class="nav-dock">
    <button class="nav-item active" onclick="navTo('dashboard')" id="nav-dashboard">
        <span class="material-symbols-outlined">grid_view</span>
        <span>GRID</span>
    </button>
    <button class="nav-item" onclick="navTo('timeline')" id="nav-timeline">
        <span class="material-symbols-outlined">history</span>
        <span>TIME</span>
    </button>
    <button class="nav-item" onclick="navTo('live')" id="nav-live">
        <span class="material-symbols-outlined">stream</span>
        <span>LIVE</span>
    </button>
    <button class="nav-item" onclick="navTo('profile')" id="nav-profile">
        <span class="material-symbols-outlined">person</span>
        <span>ID</span>
    </button>
    <button class="nav-item" onclick="navTo('archive')" id="nav-archive">
        <span class="material-symbols-outlined">folder_open</span>
        <span>DATA</span>
    </button>
</nav>

<script>
    /* --- CORE UI UTILS --- */
    function typeWriter(el, text, speed = 30) {
        if (!el) return;
        el.innerHTML = '';
        let i = 0;
        function type() {
            if (i < text.length) {
                el.innerHTML += text.charAt(i);
                i++;
                setTimeout(type, speed);
            }
        }
        type();
    }

    /* --- AUTH MANAGER --- */
    const NexusAuth = {
        currentUser: null,
        isRegistering: false,
        init() {
            const saved = localStorage.getItem('nexus_user');
            if (saved) {
                this.currentUser = JSON.parse(saved);
            }
            this.updateUI();
        },
        toggleMode() {
            this.isRegistering = !this.isRegistering;
            const btn = document.getElementById('auth-toggle-btn');
            const submit = document.querySelector('#auth-form .btn-tech');
            btn.innerText = this.isRegistering ? "SWITCH TO LOGIN" : "SWITCH TO REGISTRATION";
            submit.innerText = this.isRegistering ? "CREATE IDENTITY" : "INITIALIZE SESSION";
        },
        submit(user, pass) {
            const status = document.getElementById('auth-status');
            const btn = document.getElementById('auth-submit-btn');

            if (!user) {
                status.innerText = "!! ERROR: MISSING_ID !!";
                status.style.color = "var(--alert)";
                gsap.from(status, { x: 5, duration: 0.05, repeat: 5, yoyo: true });
                return;
            }

            btn.disabled = true;
            status.style.color = "var(--success)";
            status.innerText = ">> SYNCING_IDENTITY...";

            // Artificial delay for "snappy" but techy feel
            setTimeout(() => {
                const profile = {
                    username: user,
                    role: this.isRegistering ? "NEW ANALYST" : "ELITE ANALYST",
                    avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${user}`,
                    history: [],
                    color: 270
                };
                localStorage.setItem('nexus_user', JSON.stringify(profile));
                this.currentUser = profile;
                this.updateUI();

                status.innerText = ">> IDENTITY_VERIFIED";

                setTimeout(() => {
                    btn.disabled = false;
                    status.innerText = "";
                    toggleAuthModal();
                    navTo('profile');

                    // Trigger Welcome Notification
                    triggerBreakingNews({
                        id: -1,
                        title: `WELCOME, ${user.toUpperCase()}`,
                        content: "Neural link established. Accessing personalized grid data..."
                    });
                }, 800);
            }, 1200);
        },
        logout() {
            localStorage.removeItem('nexus_user');
            this.currentUser = null;
            this.updateUI();
            navTo('dashboard');
        },
        updateUI() {
            renderProfile();
        }
    };

    function toggleAuthModal() {
        const modal = document.getElementById('auth-modal');
        modal.classList.toggle('hidden');
        if (!modal.classList.contains('hidden')) {
            gsap.from(modal.querySelector('.filter-content'), { scale: 0.8, opacity: 0, duration: 0.3, ease: "back.out(1.7)" });
        }
    }

    function toggleAuthMode() { NexusAuth.toggleMode(); }

    function handleAuthSubmit() {
        const u = document.getElementById('auth-username').value;
        const p = document.getElementById('auth-password').value;
        NexusAuth.submit(u, p);
    }

    /* --- DATA STORE --- */
    let currentBreakingId = null;
    let currentDetailId = null;
    let db = {
        news: [],
        timeline: [],
        chats: [
            { user: "Ghost_01", msg: "Did you see the flux?" },
            { user: "NeonRider", msg: "Signal is clean today." },
            { user: "SysAdmin", msg: "Monitoring bandwidth." }
        ]
    };

    const FALLBACK_DATA = {
        "World": [
            {"title": "Neo-Tokyo Energy Crisis Averted", "source": "CyberWire", "link": "https://example.com/1"},
            {"title": "Lunar Colony Expansion Approved", "source": "Orbital News", "link": "https://example.com/2"}
        ],
        "Technology": [
            {"title": "Neural Link v4.0 Goes Open Source", "source": "TechPulse", "link": "https://example.com/3"},
            {"title": "Quantum Encryption Breached?", "source": "BitShred", "link": "https://example.com/4"}
        ],
        "Business": [
            {"title": "Arasaka Stock Rebounds After CEO Change", "source": "FinStream", "link": "https://example.com/5"}
        ]
    };

    const API_URL = 'https://ok.surf/api/v1/cors/news-feed';
    const CACHE_KEY = 'nexus_news_data';
    const CACHE_TIME_KEY = 'nexus_news_timestamp';
    const REFRESH_INTERVAL = 30 * 60 * 1000; // 30 minutes

    async function fetchNews() {
        const now = Date.now();
        const cachedTime = localStorage.getItem(CACHE_TIME_KEY);
        const cachedData = localStorage.getItem(CACHE_KEY);

        // Respect 30min sync interval
        if (cachedTime && cachedData && (now - cachedTime < REFRESH_INTERVAL)) {
            console.log("Accessing local data vault...");
            processNewsData(JSON.parse(cachedData), true);
            return;
        }

        console.log("Syncing with Global News Grid...");
        try {
            const response = await fetch(API_URL);
            const data = await response.json();

            localStorage.setItem(CACHE_KEY, JSON.stringify(data));
            localStorage.setItem(CACHE_TIME_KEY, now.toString());

            processNewsData(data, false);
        } catch (error) {
            console.error("Link Failure. Reverting to local cache...", error);
            if (cachedData) {
                processNewsData(JSON.parse(cachedData), true);
            } else {
                processNewsData(FALLBACK_DATA, true);
            }
        }
    }

    function processNewsData(data, isCached = false) {
        let flattenedNews = [];
        const categoryMap = {
            'World': 'GLOBAL',
            'Business': 'FINANCE',
            'Technology': 'TECH',
            'Science': 'SCIENCE',
            'Health': 'BIO',
            'Entertainment': 'MEDIA',
            'Sports': 'ARENA'
        };

        // Aggregate across all sectors to find the top reports
        for (const [cat, items] of Object.entries(data)) {
            items.forEach(item => {
                flattenedNews.push({
                    title: item.title,
                    region: item.source,
                    date: new Date().toLocaleDateString(),
                    cat: categoryMap[cat] || cat.toUpperCase(),
                    img: item.og || 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&w=600&q=80',
                    content: `Data harvested from ${item.source}. Critical report on ${cat} developments. Accessing full neural link...`,
                    link: item.link
                });
            });
        }

        // Ensure exactly Top 20 as requested
        const top20 = flattenedNews.slice(0, 20).map((n, i) => ({...n, id: i}));

        // Check for updates to trigger breaking news (only on fresh fetches)
        const lastHeadline = localStorage.getItem('nexus_last_headline');
        if (top20.length > 0 && top20[0].title !== lastHeadline) {
            if (lastHeadline && !isCached) triggerBreakingNews(top20[0]);
            localStorage.setItem('nexus_last_headline', top20[0].title);
        }

        db.news = top20;

        // Generate Chronology
        db.timeline = db.news.slice(0, 10).map((n, index) => ({
            time: `${12 - index}:00`,
            title: n.title,
            desc: `Signal verified from ${n.region}. Data integrity: 99.8%`
        }));

        renderNews();
        renderTimeline();
        renderArchiveStats();

        // Populate Tickers
        const tickers = ['global-ticker', 'live-ticker'];
        tickers.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.innerHTML = db.news.map(n => `<span class="ticker-item">${n.cat} // ${n.title}</span>`).join('');
            }
        });

        const syncEl = document.getElementById('last-sync');
        if (syncEl) {
            syncEl.innerText = "| LAST SYNC: " + new Date().toLocaleTimeString();
        }
    }

    function renderArchiveStats() {
        const viz = document.getElementById('archive-stats-viz');
        const filters = document.getElementById('archive-filters');
        if (!viz || !filters) return;

        const counts = {};
        db.news.forEach(n => counts[n.cat] = (counts[n.cat] || 0) + 1);

        const categories = Object.keys(counts).sort((a, b) => counts[b] - counts[a]);
        const max = Math.max(...Object.values(counts));

        // Render Charts
        viz.innerHTML = categories.map(cat => {
            const percent = (counts[cat] / max) * 100;
            return `
                <div class="stat-bar-container" style="margin-bottom: 8px;">
                    <div class="stat-label" style="margin-bottom: 2px;">
                        <span>${cat}</span>
                        <span style="color:var(--primary)">${counts[cat]} REPORTS</span>
                    </div>
                    <div class="bar-track" style="height: 4px; background: rgba(255,255,255,0.05);">
                        <div class="bar-fill" style="width: ${percent}%; height: 100%; transition: width 1.5s var(--ease-tech);"></div>
                    </div>
                </div>
            `;
        }).join('');

        // Render Filter Pills
        filters.innerHTML = `<button class="glow-badge active" onclick="filterArchive('ALL', this)" style="cursor:pointer; white-space:nowrap;">ALL_SECTORS</button>` +
            categories.map(cat => `
                <button class="glow-badge" onclick="filterArchive('${cat}', this)" style="cursor:pointer; white-space:nowrap;">${cat}</button>
            `).join('');
    }

    let activeFilter = 'ALL';
    function filterArchive(cat, btn) {
        activeFilter = cat;

        // Update UI
        document.querySelectorAll('#archive-filters .glow-badge').forEach(b => {
            b.classList.remove('active');
            b.style.background = 'rgba(138, 43, 226, 0.15)';
            b.style.color = 'var(--highlight)';
        });
        btn.classList.add('active');
        btn.style.background = 'var(--primary)';
        btn.style.color = 'white';

        applyArchiveFilters();
    }

    function applyArchiveFilters() {
        const term = document.getElementById('archive-search').value.toLowerCase();
        const filtered = db.news.filter(n => {
            const matchesSearch = n.title.toLowerCase().includes(term) || n.region.toLowerCase().includes(term);
            const matchesCat = activeFilter === 'ALL' || n.cat === activeFilter;
            return matchesSearch && matchesCat;
        });

        const container = document.getElementById('archive-feed');
        renderNewsGrid(container, filtered);
    }

    function renderNewsGrid(container, items) {
        if (!container) return;
        container.innerHTML = items.map(item => `
            <div class="glass-panel news-card" onclick="loadDetail(${item.id})">
                <img src="${item.img}" class="news-thumb" onerror="this.src='https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&w=600&q=80'">
                <div class="card-body">
                    <span class="card-cat">${item.cat}</span>
                    <h4 class="card-title">${item.title}</h4>
                    <div class="card-meta">
                        <span>${item.region}</span>
                        <span>${item.date}</span>
                    </div>
                </div>
            </div>`).join('');

        gsap.from(container.querySelectorAll('.news-card'), {
            opacity: 0, y: 10, duration: 0.2, stagger: 0.03, ease: "power2.out"
        });
    }

    function triggerBreakingNews(item) {
        currentBreakingId = item.id;
        const push = document.getElementById('push-notification');
        if (!push) return;

        document.getElementById('push-title').innerText = item.title;
        push.classList.remove('hidden');

        requestAnimationFrame(() => {
            push.classList.add('active');
            // Auto-hide after 10 seconds
            setTimeout(closePush, 10000);
        });

        // Snappy GSAP pop
        gsap.fromTo(push, { x: "120%" }, { x: "0%", duration: 0.3, ease: "power4.out" });
    }

    /* --- CORE FUNCTIONS --- */

    // Navigation Logic with GSAP (Snappy Transitions)
    function navTo(viewId) {
        const currentView = document.querySelector('.view-section:not(.hidden)');
        const targetView = document.getElementById(viewId);

        if (currentView === targetView) return;

        // Animate Out
        if (currentView) {
            gsap.to(currentView, {
                opacity: 0,
                y: -10,
                filter: "brightness(2) contrast(2)",
                duration: 0.15,
                ease: "power4.in",
                onComplete: () => {
                    currentView.classList.add('hidden');
                    showTarget();
                }
            });
        } else {
            showTarget();
        }

        function showTarget() {
            targetView.classList.remove('hidden');
            gsap.fromTo(targetView,
                { opacity: 0, y: 10, scale: 0.98, filter: "brightness(0.5)" },
                { opacity: 1, y: 0, scale: 1, filter: "brightness(1)", duration: 0.25, ease: "power4.out" }
            );
        }

        // Update Dock
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const navBtn = document.getElementById('nav-' + viewId);
        if(navBtn) {
            navBtn.classList.add('active');
            gsap.from(navBtn.querySelector('.material-symbols-outlined'), { scale: 0.5, duration: 0.2, ease: "back.out(2)" });
        }

        window.scrollTo({ top: 0, behavior: 'smooth' });

        // Re-init context specific features if needed
        if (viewId === 'live') initLive();
    }

    // System Console Logic
    function updateConsoleLogs() {
        const consoleEl = document.getElementById('system-console');
        if (!consoleEl) return;

        const LOG_LEVELS = ["INFO", "DEBUG", "WARN", "CRIT", "SYNC"];
        const SENSORS = ["NEURAL_LINK", "QUANTUM_RELAY", "GRID_ANALYZER", "CORE_BUFFER", "SCRAPER_BOT_7"];
        const ACTIONS = ["CONNECTED", "DISCONNECTED", "PACKET_LOSS", "LATENCY_SPIKE", "ENCRYPTION_ACTIVE", "DATA_HARVESTED", "REDUNDANCY_CHECK", "BYPASS_ATTEMPT"];

        function addLog() {
            const ts = new Date().toLocaleTimeString();
            const lvl = LOG_LEVELS[Math.floor(Math.random() * LOG_LEVELS.length)];
            const sensor = SENSORS[Math.floor(Math.random() * SENSORS.length)];
            const action = ACTIONS[Math.floor(Math.random() * ACTIONS.length)];
            const val = Math.floor(Math.random() * 899) + 100;

            const div = document.createElement('div');
            div.style.marginBottom = "2px";
            div.style.opacity = "0";
            div.innerHTML = `<span style="color:var(--text-muted)">[${ts}]</span> <span style="color:var(--primary)">${lvl}::${sensor}</span> >> ${action} (v${val})`;

            consoleEl.appendChild(div);
            gsap.to(div, { opacity: 1, duration: 0.3 });

            if (consoleEl.children.length > 20) {
                consoleEl.removeChild(consoleEl.firstChild);
            }

            consoleEl.scrollTop = consoleEl.scrollHeight;

            // Update Latency
            const latEl = document.getElementById('console-latency');
            if (latEl) latEl.innerText = `LATENCY: ${Math.floor(Math.random() * 40) + 10}ms`;
        }

        // Initial logs
        for(let i=0; i<5; i++) addLog();

        // Loop
        setInterval(addLog, 2000);
    }

    // Micro-interactions
    function initInteractions() {
        // News Card Hover
        document.addEventListener('mouseover', (e) => {
            const card = e.target.closest('.news-card');
            if (card) {
                gsap.to(card, { y: -5, duration: 0.2, ease: "power2.out" });
            }
        });
        document.addEventListener('mouseout', (e) => {
            const card = e.target.closest('.news-card');
            if (card) {
                gsap.to(card, { y: 0, duration: 0.2, ease: "power2.in" });
            }
        });

        // Snappy Button Hover
        document.addEventListener('mouseenter', (e) => {
            if (e.target.classList && (e.target.classList.contains('btn-tech') || e.target.classList.contains('fab'))) {
                gsap.to(e.target, { scale: 1.05, boxShadow: "0 0 20px var(--primary)", duration: 0.2 });
            }
        }, true);
        document.addEventListener('mouseleave', (e) => {
            if (e.target.classList && (e.target.classList.contains('btn-tech') || e.target.classList.contains('fab'))) {
                gsap.to(e.target, { scale: 1, boxShadow: "none", duration: 0.2 });
            }
        }, true);
    }

    // Load News to Dashboard
    function renderNews() {
        const container = document.getElementById('news-feed');
        const archive = document.getElementById('archive-feed');
        if (!container) return;

        let html = '';
        if (db.news.length === 0) {
            html = '<div class="skeleton" style="height: 200px; width: 100%; border-radius: 12px;"></div>'.repeat(3);
        } else {
            db.news.forEach(item => {
                html += `
                <div class="glass-panel news-card" onclick="loadDetail(${item.id})">
                    <img src="${item.img}" class="news-thumb" onerror="this.src='https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&w=600&q=80'">
                    <div class="card-body">
                        <span class="card-cat">${item.cat}</span>
                        <h4 class="card-title">${item.title}</h4>
                        <div class="card-meta">
                            <span>${item.region} [SEC-${Math.floor(Math.random()*99)}]</span>
                            <span>${item.date}</span>
                        </div>
                    </div>
                </div>`;
            });
        }
        
        container.innerHTML = html;
        if (archive) {
            archive.innerHTML = html;
            const totalEl = document.getElementById('archive-total');
            if (totalEl) totalEl.innerText = db.news.length;
        }

        // Animate entrance (Snappy Stagger)
        gsap.from(".news-card", {
            y: 20,
            opacity: 0,
            duration: 0.3,
            stagger: 0.05,
            ease: "power2.out"
        });
    }

    // Load Detail View
    function loadDetail(id) {
        currentDetailId = id;
        const item = db.news.find(i => i.id === id);
        if (!item) return;

        // Add to history if logged in
        if (NexusAuth.currentUser) {
            if (!NexusAuth.currentUser.history) NexusAuth.currentUser.history = [];
            // Avoid duplicates
            if (!NexusAuth.currentUser.history.some(h => h.id === id)) {
                NexusAuth.currentUser.history.unshift({ id: item.id, title: item.title, time: new Date().toLocaleTimeString() });
                if (NexusAuth.currentUser.history.length > 5) NexusAuth.currentUser.history.pop();
                localStorage.setItem('nexus_user', JSON.stringify(NexusAuth.currentUser));
            }

            // Update Bookmark Button UI
            const isBookmarked = (NexusAuth.currentUser.bookmarks || []).includes(id);
            const btn = document.getElementById('btn-bookmark');
            if(btn) {
                btn.style.background = isBookmarked ? 'var(--primary)' : '#000';
                btn.style.color = isBookmarked ? 'white' : 'var(--text-main)';
            }
        }
        
        document.getElementById('detail-img').style.backgroundImage = `url(${item.img})`;
        typeWriter(document.getElementById('detail-title'), item.title, 20);
        document.getElementById('detail-region').innerText = item.region;
        document.getElementById('detail-date').innerText = item.date;
        document.getElementById('detail-text').innerText = item.content + " Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.";
        
        const linkBtn = document.getElementById('detail-link');
        if (linkBtn) linkBtn.href = item.link || '#';

        const tags = document.getElementById('detail-tags');
        tags.innerHTML = `<span class="glow-badge">${item.cat}</span><span class="glow-badge" style="border-color:white; color:white;">VERIFIED</span>`;
        
        navTo('detail');

        // Snappy Glitch Entrance
        const content = document.querySelector('.detail-content-wrapper');
        if (content) {
            const tl = gsap.timeline();
            tl.to(content, { x: 10, opacity: 0.5, duration: 0.05 })
              .to(content, { x: -10, opacity: 0.8, duration: 0.05 })
              .to(content, { x: 5, opacity: 0.3, duration: 0.05 })
              .to(content, { x: 0, opacity: 1, duration: 0.1 });
        }
    }
    
    // Wrapper for hotspot clicks
    function loadNews(index) {
        // Find news in 'GLOBAL' category for hotspots
        const globalNews = db.news.filter(n => n.cat === 'GLOBAL');
        if (globalNews.length > index) {
            loadDetail(globalNews[index].id);
        } else if (db.news.length > index) {
            loadDetail(db.news[index].id);
        }
    }

    // Render Timeline
    function renderTimeline() {
        const container = document.getElementById('timeline-container');
        if (!container) return;
        container.innerHTML = '';
        db.timeline.forEach(item => {
            container.innerHTML += `
            <div class="glass-panel timeline-node" style="padding: 15px; border-radius: 8px;">
                <div class="node-dot"></div>
                <div class="time-label">${item.time}</div>
                <h4 style="margin: 0 0 5px 0;">${item.title}</h4>
                <p style="margin:0; font-size: 0.85rem; color: #aaa;">${item.desc}</p>
            </div>`;
        });
    }

    // Detail View Features
    function toggleBookmark() {
        if (!NexusAuth.currentUser) {
            toggleAuthModal();
            return;
        }

        if (!NexusAuth.currentUser.bookmarks) NexusAuth.currentUser.bookmarks = [];
        const idx = NexusAuth.currentUser.bookmarks.indexOf(currentDetailId);

        const btn = document.getElementById('btn-bookmark');
        if (idx === -1) {
            NexusAuth.currentUser.bookmarks.push(currentDetailId);
            btn.style.background = 'var(--primary)';
            btn.style.color = 'white';
            gsap.from(btn, { scale: 1.5, duration: 0.3, ease: "back.out" });
        } else {
            NexusAuth.currentUser.bookmarks.splice(idx, 1);
            btn.style.background = '#000';
            btn.style.color = 'var(--text-main)';
        }

        localStorage.setItem('nexus_user', JSON.stringify(NexusAuth.currentUser));
        renderProfile();
    }

    function shareLink() {
        const item = db.news.find(n => n.id === currentDetailId);
        if (!item) return;

        const dummy = document.createElement('input');
        document.body.appendChild(dummy);
        dummy.value = item.link || window.location.href;
        dummy.select();
        document.execCommand('copy');
        document.body.removeChild(dummy);

        const btn = document.getElementById('btn-share');
        const originalIcon = btn.innerHTML;
        btn.innerHTML = '<span class="material-symbols-outlined" style="font-size:18px;">done</span>';
        btn.style.background = 'var(--success)';

        setTimeout(() => {
            btn.innerHTML = originalIcon;
            btn.style.background = '#000';
        }, 2000);

        // Show notification
        const status = document.getElementById('system-status');
        const originalStatus = status.innerText;
        status.innerText = "● LINK_COPIED";
        status.style.color = "var(--primary)";
        setTimeout(() => {
            status.innerText = originalStatus;
            status.style.color = "var(--success)";
        }, 3000);
    }

    // Filters
    function toggleFilters() {
        const modal = document.getElementById('filter-modal');
        modal.classList.toggle('hidden');
    }

    // Breaking News Push Logic
    function closePush() {
        const push = document.getElementById('push-notification');
        push.classList.remove('active');
        setTimeout(() => push.classList.add('hidden'), 300);
    }

    function renderProfile() {
        const container = document.getElementById('profile-content');
        if (!container) return;

        if (!NexusAuth.currentUser) {
            container.innerHTML = `
                <div class="glass-panel flex-center" style="height: 400px; flex-direction: column; border-radius: 20px;">
                    <span class="material-symbols-outlined" style="font-size: 64px; color: var(--primary); margin-bottom: 20px;">lock</span>
                    <h2 style="font-family: var(--font-head);">ACCESS RESTRICTED</h2>
                    <p style="color: var(--text-muted); margin-bottom: 30px;">Login required to view personal ID and history.</p>
                    <button class="btn-tech" onclick="toggleAuthModal()" style="width: auto; padding: 12px 40px;">INITIALIZE ACCESS</button>
                </div>
            `;
            return;
        }

        const user = NexusAuth.currentUser;
        container.innerHTML = `
            <div class="glass-panel profile-card" style="border-radius: 16px; position: relative;">
                <button onclick="NexusAuth.logout()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: var(--alert); cursor: pointer; display: flex; align-items: center; gap: 5px;">
                    <span class="material-symbols-outlined" style="font-size: 18px;">logout</span> EXIT
                </button>
                <div class="avatar-ring">
                    <img src="${user.avatar}" alt="User">
                    <div class="status-dot"></div>
                </div>
                <div>
                    <h2 style="font-family: var(--font-head); margin: 0;">${user.username.toUpperCase()}</h2>
                    <span style="color: var(--accent); font-size: 0.8rem; letter-spacing: 1px;">${user.role}</span>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin: 20px 0;">
                <div class="glass-panel" style="flex:1; padding: 15px; text-align: center; border-radius: 12px;">
                    <div style="font-family: var(--font-head); color: var(--primary); font-size: 1.2rem;">${user.history ? user.history.length : 0}</div>
                    <div style="font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase;">Reports Read</div>
                </div>
                <div class="glass-panel" style="flex:1; padding: 15px; text-align: center; border-radius: 12px;">
                    <div style="font-family: var(--font-head); color: var(--success); font-size: 1.2rem;">94%</div>
                    <div style="font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase;">Sync Level</div>
                </div>
            </div>

            <h3 style="font-family: var(--font-head); margin: 30px 0 15px 0;" class="text-neon">INTERFACE CALIBRATION</h3>
            <div class="glass-panel" style="border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                <label style="color: var(--text-muted); font-size: 0.8rem; display:block; margin-bottom: 15px;">ACCENT COLOR SHIFT</label>
                <input type="range" class="tech-slider" min="0" max="360" value="${user.color || 270}" oninput="updateColor(this.value)">
                <div style="display:flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted);">
                    <span>0°</span><span>180°</span><span>360°</span>
                </div>

                <div class="region-control" style="margin-top:20px; padding:10px 0; border-bottom:none;">
                    <span>STEALTH_MODE</span>
                    <input type="checkbox" class="tech-switch" ${user.stealth ? 'checked' : ''} onchange="updatePref('stealth', this.checked)">
                </div>
                <div class="region-control" style="padding:10px 0; border-bottom:none;">
                    <span>AUTO_SYNC_DATA</span>
                    <input type="checkbox" class="tech-switch" ${user.autosync ? 'checked' : ''} onchange="updatePref('autosync', this.checked)">
                </div>
            </div>

            <h3 style="font-family: var(--font-head); margin-bottom: 15px;" class="text-neon">NEURAL HISTORY</h3>
            <div class="glass-panel" style="border-radius: 12px; padding: 5px; margin-bottom: 25px;">
                ${user.history && user.history.length > 0 ?
                    user.history.map(h => `
                        <div class="region-control" style="cursor:pointer;" onclick="loadDetail(${h.id})">
                            <div style="display:flex; flex-direction:column;">
                                <span style="font-weight:600; font-size:0.9rem;">${h.title}</span>
                                <span style="font-size:0.7rem; color:var(--text-muted);">${h.time}</span>
                            </div>
                            <span class="material-symbols-outlined" style="font-size: 16px; color: var(--primary);">chevron_right</span>
                        </div>
                    `).join('') :
                    '<div style="padding: 20px; text-align: center; color: var(--text-muted);">NO RECENT LOGS FOUND</div>'
                }
            </div>

            <h3 style="font-family: var(--font-head); margin-bottom: 15px;" class="text-neon">BOOKMARKS</h3>
            <div class="glass-panel" style="border-radius: 12px; padding: 5px;">
                ${user.bookmarks && user.bookmarks.length > 0 ?
                    user.bookmarks.map(bid => {
                        const item = db.news.find(n => n.id === bid);
                        if (!item) return '';
                        return `
                        <div class="region-control" style="cursor:pointer;" onclick="loadDetail(${item.id})">
                            <div style="display:flex; flex-direction:column;">
                                <span style="font-weight:600; font-size:0.9rem;">${item.title}</span>
                                <span style="font-size:0.7rem; color:var(--text-muted);">${item.cat} // ${item.region}</span>
                            </div>
                            <span class="material-symbols-outlined" style="font-size: 16px; color: var(--primary);">bookmark</span>
                        </div>`;
                    }).join('') :
                    '<div style="padding: 20px; text-align: center; color: var(--text-muted);">NO BOOKMARKS SAVED</div>'
                }
            </div>
        `;
    }

    function updateColor(val) {
        document.documentElement.style.setProperty('--primary-hue', val);
        if (NexusAuth.currentUser) {
            NexusAuth.currentUser.color = val;
            localStorage.setItem('nexus_user', JSON.stringify(NexusAuth.currentUser));
        }
    }

    function updatePref(key, val) {
        if (NexusAuth.currentUser) {
            NexusAuth.currentUser[key] = val;
            localStorage.setItem('nexus_user', JSON.stringify(NexusAuth.currentUser));
        }
    }

    // Live News Streams (YouTube Channel IDs)
    let liveIntervals = [];
    const STREAMS = [
        { id: 0, name: "SKY NEWS (UK)", status: "STABLE", cid: "UC0p5jTq6VN_Ozjjlp0vH9qA", signal: 5, thumb: "https://images.unsplash.com/photo-1585829365234-781f75d9c2ca?auto=format&fit=crop&w=200&q=80" },
        { id: 1, name: "AL JAZEERA", status: "STABLE", cid: "UCNye-wNBqNL5ZzHSJj3l8Bg", signal: 4, thumb: "https://images.unsplash.com/photo-1495020689067-958852a7765e?auto=format&fit=crop&w=200&q=80" },
        { id: 2, name: "DW NEWS (ENG)", status: "STABLE", cid: "UCknLrEdhRCp1aegoPtTNnxA", signal: 4, thumb: "https://images.unsplash.com/photo-1504711434969-e33886168f5c?auto=format&fit=crop&w=200&q=80" },
        { id: 3, name: "ABC NEWS (US)", status: "WARNING", cid: "UCBi2erQHkG74fkW3XWuQDnQ", signal: 3, thumb: "https://images.unsplash.com/photo-1529107386315-e1a2ed48a620?auto=format&fit=crop&w=200&q=80" },
        { id: 4, name: "FRANCE 24", status: "STABLE", cid: "UC8AM7A11YcI0_V88L6_fS-g", signal: 5, thumb: "https://images.unsplash.com/photo-1434030216411-0b793f4b4173?auto=format&fit=crop&w=200&q=80" },
        { id: 5, name: "BLOOMBERG", status: "STABLE", cid: "UCIALMKvObAkpaFVohLYqdfw", signal: 5, thumb: "https://images.unsplash.com/photo-1611974717483-363e1730da46?auto=format&fit=crop&w=200&q=80" }
    ];

    let activeStreamId = 0;

    function initLive() {
        // Clear previous intervals if any
        liveIntervals.forEach(clearInterval);
        liveIntervals = [];

        renderStreamSelector();

        // Auto-load first stream if none active
        if (document.getElementById('live-video').src === "" || document.getElementById('live-video').src.includes('Nexus_News.html')) {
            switchStream(activeStreamId);
        }

        // Ticker
        const ticker = document.getElementById('live-ticker');
        if (ticker) {
            ticker.innerHTML = db.news.map(n => `<span class="ticker-item">${n.title} [//] ${n.region}</span>`).join('');
        }

        // Viewers
        const viewerInt = setInterval(() => {
            const el = document.getElementById('live-viewers');
            if (el) {
                let val = parseFloat(el.innerText);
                val += (Math.random() - 0.5);
                el.innerText = val.toFixed(1) + "K";
            }
        }, 1500);
        liveIntervals.push(viewerInt);

        // Chat
        const chatContainer = document.getElementById('chat-container');
        const inputArea = document.getElementById('chat-input-area');
        if (chatContainer) {
            chatContainer.innerHTML = '';
            db.chats.forEach(c => addChat(c.user, c.msg));
        }

        if (inputArea) {
            if (NexusAuth.currentUser) {
                inputArea.innerHTML = `
                    <input type="text" id="chat-input" placeholder="ENCRYPTED MESSAGE..." style="flex: 1; background: transparent; border: none; color: white; outline: none; font-family: var(--font-body);">
                    <button onclick="sendChatMessage()" style="background: none; border: none; color: var(--primary); cursor: pointer;"><span class="material-symbols-outlined">send</span></button>
                `;
            } else {
                inputArea.innerHTML = `
                    <div style="flex:1; text-align:center; color:var(--text-muted); font-size:0.8rem;">
                        <span onclick="navTo('profile')" style="color:var(--primary); cursor:pointer; text-decoration:underline;">LOGIN</span> TO JOIN TRANSMISSION
                    </div>
                `;
            }
        }

        // Random new msg
        const chatInt = setInterval(() => {
            const users = ["Runner", "Net_Zero", "ChromeHeart", "V_"];
            const msgs = ["System looks stable.", "Any updates?", "Who is watching?", "Signal is strong."];
            addChat(users[Math.floor(Math.random()*users.length)], msgs[Math.floor(Math.random()*msgs.length)]);
        }, 3500);
        liveIntervals.push(chatInt);

    // Neural Bot Messages
    const BOT_MSGS = [
        "LINK_STATUS: Handshake sequence verified.",
        "NOTICE: Bandwidth surge detected in Sector 4.",
        "ENCRYPTION: Level 5 protocol active.",
        "UPLINK_STABILITY: 99.4% average.",
        "ALERT: Minimal packet loss from Lunar relay.",
        "SYSTEM: Interface calibration complete."
    ];
    const botInt = setInterval(() => {
        const msg = BOT_MSGS[Math.floor(Math.random() * BOT_MSGS.length)];
        addChat("NEURAL_NET", msg, true);
    }, 8000);
    liveIntervals.push(botInt);
    }

    function renderStreamSelector() {
        const selector = document.getElementById('stream-selector');
        if (!selector) return;

        selector.innerHTML = STREAMS.map(s => `
            <div class="uplink-card ${s.id === activeStreamId ? 'active' : ''}" onclick="switchStream(${s.id})">
                <div class="uplink-badge"><div class="live-dot"></div> LIVE</div>
                <img src="${s.thumb}" class="uplink-thumb">
                <div class="signal-bars">
                    ${[1, 2, 3, 4, 5].map(i => `<div class="bar ${i <= s.signal ? 'active' : ''}" style="height:${i * 3}px;"></div>`).join('')}
                </div>
                <div style="font-size:0.55rem; padding:6px; text-align:center; background:rgba(0,0,0,0.8); border-top:1px solid rgba(255,255,255,0.05); font-weight:600;">
                    ${s.name}
                </div>
            </div>
        `).join('');
    }

    function switchStream(id) {
        // Prevent redundant switching but allow if current src is empty
        if (id === activeStreamId && document.getElementById('live-video').src !== "") return;

        const noise = document.getElementById('static-noise');
        const video = document.getElementById('live-video');

        // 1. Start Transition Effect
        const tl = gsap.timeline();
        tl.to(noise, { opacity: 0.8, duration: 0.15 })
          .to(video, { filter: "contrast(3) brightness(2) blur(10px)", opacity: 0.3, duration: 0.1 }, 0)
          .add(() => {
              // 2. Perform Switch Mid-Noise
              activeStreamId = id;
              const stream = STREAMS.find(s => s.id === id);
              if (!stream) return;

              renderStreamSelector();

              if (video) {
                  // YouTube Live Stream Embed format by Channel ID
                  video.src = `https://www.youtube.com/embed/live_stream?channel=${stream.cid}&autoplay=1&mute=1&controls=0&modestbranding=1&rel=0&iv_load_policy=3`;
              }

              const nameEl = document.getElementById('stream-name');
              const statusEl = document.getElementById('stream-status-label');
              const signalEl = document.getElementById('stream-signal');

              if (nameEl) nameEl.innerText = stream.name;

              // Random Technical Data
              document.getElementById('link-bitrate').innerText = `BITRATE: ${(Math.random() * 50 + 10).toFixed(1)} Mbps`;
              document.getElementById('stream-encryption').innerText = ["AES", "RSA", "P2P", "SSL"][Math.floor(Math.random() * 4)];

              // Signal mapping
              const signalPercent = stream.signal * 20;
              if (signalEl) {
                  signalEl.innerText = signalPercent + "%";
                  signalEl.style.color = stream.signal < 2 ? 'var(--alert)' : (stream.signal < 4 ? 'var(--primary)' : 'var(--success)');
              }
              if (statusEl) {
                  statusEl.innerText = "SIGNAL " + (stream.signal === 0 ? "LOST" : (stream.signal < 3 ? "UNSTABLE" : "STABLE"));
                  statusEl.style.color = stream.signal < 3 ? 'var(--alert)' : 'var(--success)';
              }
          })
          // 3. End Transition
          .to(noise, { opacity: 0, duration: 0.2, delay: 0.1 })
          .to(video, { filter: "contrast(1) brightness(1) blur(0px)", opacity: 0.8, duration: 0.3 }, "-=0.2");
    }

    function toggleMute(btn) {
        const video = document.getElementById('live-video');
        const isMuted = video.src.includes('mute=1');

        btn.classList.toggle('active');
        if (isMuted) {
            video.src = video.src.replace('mute=1', 'mute=0');
            btn.innerHTML = '<span class="material-symbols-outlined" style="font-size:14px;">volume_up</span> AUDIO';
        } else {
            video.src = video.src.replace('mute=0', 'mute=1');
            btn.innerHTML = '<span class="material-symbols-outlined" style="font-size:14px;">volume_off</span> MUTED';
        }
    }

    function toggleRec(btn) {
        btn.classList.toggle('active');
        btn.innerHTML = btn.classList.contains('active') ?
            '<span class="material-symbols-outlined" style="font-size:14px; color:var(--alert);">fiber_manual_record</span> RECORDING' :
            '<span class="material-symbols-outlined" style="font-size:14px;">fiber_manual_record</span> REC';
    }

    function toggleZoom(btn) {
        const video = document.getElementById('live-video');
        btn.classList.toggle('active');
        gsap.to(video, { scale: btn.classList.contains('active') ? 1.5 : 1, duration: 0.4, ease: "power2.inOut" });
    }

    function addChat(u, m, isBot = false) {
        const chatContainer = document.getElementById('chat-container');
        if (!chatContainer) return;
        const div = document.createElement('div');
        div.className = 'chat-bubble';
        if (isBot) {
            div.style.borderLeft = "2px solid var(--accent)";
            div.style.background = "rgba(0, 240, 255, 0.05)";
        }
        div.innerHTML = `<span class="chat-user" style="color:${isBot ? 'var(--success)' : 'var(--highlight)'}">${u}:</span> ${m}`;
        chatContainer.appendChild(div);

        // Snappy GSAP Entrance
        gsap.from(div, {
            x: -20,
            opacity: 0,
            duration: 0.3,
            ease: "power2.out"
        });

        // Smooth Auto-scroll
        chatContainer.scrollTo({
            top: chatContainer.scrollHeight,
            behavior: 'smooth'
        });
    }

    function sendChatMessage() {
        const input = document.getElementById('chat-input');
        if (!input || !input.value.trim()) return;
        if (!NexusAuth.currentUser) return;

        addChat(NexusAuth.currentUser.username, input.value);
        input.value = '';
    }

    // Archive Search
    function initSearch() {
        const input = document.getElementById('archive-search');
        if (!input) return;
        input.addEventListener('input', () => applyArchiveFilters());
    }

    /* --- INITIALIZATION --- */
    window.addEventListener('DOMContentLoaded', () => {
        // Boot Sequence
        const bootBar = document.getElementById('boot-bar');
        const bootLoader = document.getElementById('boot-loader');
        const bootText = document.getElementById('boot-text');

        const bootTl = gsap.timeline();
        bootTl.to(bootBar, { width: "100%", duration: 0.8, ease: "power4.inOut" })
              .add(() => {
                  if (bootText) {
                      typeWriter(bootText, "LINK ESTABLISHED. IDENTITY SYNCED.");
                      bootText.style.color = "var(--success)";
                  }
                  gsap.to(bootBar, { backgroundColor: "var(--success)", duration: 0.1 });
              })
              .to(bootLoader, { opacity: 0, duration: 0.4, delay: 0.8, onComplete: () => bootLoader.remove() });

        NexusAuth.init();
        fetchNews();
        initLive();
        initSearch();
        initInteractions();
        updateConsoleLogs();

        // 30-minute auto-refresh check
        setInterval(() => {
            fetchNews();
        }, 60000); // Check every minute, fetchNews handles the 30min logic
        
        // Trigger Initial "Welcome" Breaking News after 5s
        setTimeout(() => {
            if (db.news.length > 0) {
                triggerBreakingNews(db.news[0]);
            }
        }, 5000);
    });

</script>
</body>
</html>