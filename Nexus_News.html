<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS // GLOBAL NEWS GRID</title>
    
    <!-- External Assets: Google Fonts & Material Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />

    <!-- GSAP for High-End Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* --- CORE VARIABLES & THEME --- */
        :root {
            --primary-hue: 270;
            --bg-deep: #050505;
            --bg-dark: #0a0a0a;
            --bg-panel: rgba(20, 20, 20, 0.6);
            
            --scanline-opacity: 0.1;
            --glitch-intensity: 0.5;

            --primary: hsl(var(--primary-hue), 70%, 53%); /* Electric Violet */
            --accent: hsl(calc(var(--primary-hue) + 20), 90%, 53%); /* Neon Purple */
            --highlight: #E0B0FF;
            --alert: #FF003C;
            --success: #00F0FF;
            
            --text-main: #FFFFFF;
            --text-muted: #A0A0A0;
            
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-blur: blur(16px);
            
            --shadow-neon: 0 0 10px rgba(138, 43, 226, 0.5), 0 0 20px rgba(138, 43, 226, 0.3);
            --shadow-alert: 0 0 15px rgba(255, 0, 60, 0.6);
            
            --font-head: 'Orbitron', sans-serif;
            --font-body: 'Rajdhani', sans-serif;
            
            --ease-tech: cubic-bezier(0.19, 1, 0.22, 1);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow-x: hidden;
            background-image: 
                linear-gradient(rgba(138, 43, 226, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(138, 43, 226, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            min-height: 100vh;
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 2px; }

        .hidden { display: none !important; opacity: 0; }
        .flex-center { display: flex; justify-content: center; align-items: center; }
        .text-neon { text-shadow: 0 0 8px var(--primary); color: var(--highlight); }
        .text-alert { text-shadow: 0 0 8px var(--alert); color: var(--alert); }
        
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
            border-top: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .scanline-effect {
            position: fixed; inset: 0; width: 100%; height: 2px;
            background: var(--primary); opacity: var(--scanline-opacity);
            pointer-events: none !important; z-index: 10000;
            animation: scanline 8s linear infinite;
        }
        @keyframes scanline { 0% { transform: translateY(-100vh); } 100% { transform: translateY(100vh); } }

        .static-overlay {
            position: fixed; inset: 0;
            background: url('https://media.giphy.com/media/oEI9uWUqWMrBK/giphy.gif');
            background-size: cover; opacity: 0;
            pointer-events: none !important; z-index: 10001;
            mix-blend-mode: screen;
        }

        #app {
            max-width: 1200px;
            margin: 0 auto;
            padding-bottom: 90px;
            position: relative;
            z-index: 10;
        }

        .top-bar {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(5, 5, 5, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .brand { font-family: var(--font-head); font-weight: 900; letter-spacing: 2px; font-size: 1.3rem; }
        .brand span { color: var(--primary); }
        
        .nav-dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            height: 60px;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--text-muted); background: none; border: none; cursor: pointer;
            width: 100%; height: 100%; transition: 0.2s var(--ease-tech); position: relative;
        }
        .nav-item.active { color: var(--text-main); }
        .nav-item.active .material-symbols-outlined { color: var(--primary); text-shadow: 0 0 10px var(--primary); }
        .nav-item span { font-size: 9px; font-weight: 700; letter-spacing: 1px; margin-top: 2px; }

        .view-section { padding: 20px; }

        .module-header { margin-bottom: 20px; border-left: 3px solid var(--primary); padding-left: 15px; }
        .module-title { font-family: var(--font-head); font-size: 1.5rem; margin: 0; letter-spacing: 1px; }
        .module-subtitle { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; }

        .world-map-container {
            position: relative; height: 240px; border-radius: 12px; overflow: hidden; margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            background: radial-gradient(circle at center, #1a0b2e 0%, #050505 100%);
        }
        .map-bg {
            width: 100%; height: 100%;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/2000px-World_map_blank_without_borders.svg.png');
            background-size: cover; background-position: center;
            filter: invert(1) hue-rotate(240deg) brightness(0.4) opacity(0.3);
            mix-blend-mode: screen;
        }
        .hotspot {
            position: absolute; width: 6px; height: 6px; background: var(--accent); border-radius: 50%;
            box-shadow: 0 0 8px var(--accent); cursor: pointer; transform: translate(-50%, -50%);
        }
        .hotspot::before {
            content: ''; position: absolute; inset: -4px; border: 1px solid var(--accent); border-radius: 50%;
            animation: ripple 2s infinite ease-out;
        }
        @keyframes ripple { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }

        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .news-card {
            border-radius: 10px; overflow: hidden; cursor: pointer; position: relative;
            border: 1px solid rgba(255,255,255,0.05);
            transition: transform 0.15s var(--ease-tech), border-color 0.15s var(--ease-tech);
        }
        .news-card:hover {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(var(--primary-hue), 70%, 53%, 0.15);
            transform: translateY(-4px) scale(1.02);
        }
        .news-thumb {
            height: 150px; width: 100%; object-fit: cover;
            filter: grayscale(100%) contrast(1.2) brightness(0.8);
            transition: 0.3s var(--ease-tech);
        }
        .news-card:hover .news-thumb { filter: grayscale(20%) contrast(1.1) brightness(1); }
        .card-body { padding: 15px; }
        .card-cat { font-size: 9px; font-weight: 700; color: var(--accent); text-transform: uppercase; margin-bottom: 6px; display: block; }
        .card-title { font-family: var(--font-head); font-size: 1rem; margin: 0 0 8px 0; line-height: 1.3; height: 2.6rem; overflow: hidden; }

        .ticker-container { width: 100%; background: rgba(5,5,5,0.9); border-bottom: 1px solid rgba(255,255,255,0.05); overflow: hidden; white-space: nowrap; padding: 6px 0; }
        .ticker-content { display: inline-block; padding-left: 100%; animation: ticker 60s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 30px; font-size: 0.75rem; color: var(--text-muted); font-weight: 500; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        .btn-tech {
            padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 4px;
            font-family: var(--font-head); font-size: 0.7rem; font-weight: 700; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px; transition: 0.2s;
        }
        .btn-tech:hover { background: var(--accent); box-shadow: var(--shadow-neon); }

        .glow-badge {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-muted); padding: 5px 12px; border-radius: 20px; font-size: 0.65rem;
            font-weight: 700; cursor: pointer; transition: 0.2s;
        }
        .glow-badge.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: var(--shadow-neon); }

        .timeline-wrapper { position: relative; padding-left: 20px; border-left: 1px solid rgba(255,255,255,0.1); }
        .timeline-node { margin-bottom: 25px; position: relative; padding: 15px; border-radius: 8px; }
        .node-dot { position: absolute; left: -24.5px; top: 20px; width: 8px; height: 8px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 8px var(--accent); }

        /* Detail View Enhancements */
        .detail-hero { height: 35vh; background-size: cover; background-position: center; position: relative; }
        .detail-hero::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to bottom, transparent, var(--bg-deep)); }
        .detail-body { padding: 30px 20px; margin-top: -50px; position: relative; z-index: 20; }

        .integrity-scanner {
            margin: 20px 0; padding: 15px; border-radius: 8px; background: rgba(0,0,0,0.3);
            border: 1px dashed rgba(255,255,255,0.1); display: flex; align-items: center; gap: 15px;
        }
        .scanner-bar { flex: 1; height: 2px; background: #222; position: relative; overflow: hidden; }
        .scanner-fill { position: absolute; left: 0; top: 0; height: 100%; width: 0%; background: var(--primary); }

        .badge-verified {
            display: flex; align-items: center; gap: 4px; font-size: 8px; font-weight: 800;
            color: var(--success); background: rgba(0, 240, 255, 0.1); border: 1px solid var(--success);
            padding: 2px 6px; border-radius: 3px;
        }
        .badge-unverified {
            display: flex; align-items: center; gap: 4px; font-size: 8px; font-weight: 800;
            color: var(--alert); background: rgba(255, 0, 60, 0.1); border: 1px solid var(--alert);
            padding: 2px 6px; border-radius: 3px;
        }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000;
            display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px);
        }
        .modal-content { width: 90%; max-width: 400px; padding: 25px; border-radius: 12px; }

        @keyframes glitch-hover {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        .glitch-text:hover { animation: glitch-hover 0.2s infinite; color: var(--accent); }

        /* Mobile specific fixes */
        @media (max-width: 640px) {
            .brand { font-size: 1.1rem; }
            .news-grid { grid-template-columns: 1fr; }
            .detail-hero { height: 25vh; }
        }
    </style>
</head>
<body>

<div class="scanline-effect"></div>
<div class="static-overlay" id="global-glitch"></div>

<div id="boot-loader" style="position:fixed; inset:0; background:#000; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:var(--font-head); overflow:hidden;">
    <div id="boot-status" style="color:var(--primary); font-size:0.7rem; margin-bottom:10px; font-weight:700;">NEXUS_OS // V.4.0.2</div>
    <div id="boot-log" style="color:#333; font-size:0.5rem; text-align:center; height:60px; overflow:hidden; font-family:monospace; line-height:1.5;"></div>
    <div style="width:150px; height:1px; background:#111; margin-top:20px; position:relative;">
        <div id="boot-bar" style="position:absolute; inset:0; background:var(--primary); width:0%;"></div>
    </div>
</div>

<div id="app">
    <header class="top-bar">
        <div class="brand glitch-text">NEXUS<span>//</span>GRID</div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div class="hidden md:flex items-center gap-2" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); padding: 2px 8px; border-radius: 4px;">
                <span style="font-size: 0.5rem; color: var(--text-muted); font-family: var(--font-head);">SECTOR:</span>
                <select id="sector-filter" onchange="filterByCategory(this.value)" style="background: transparent; color: var(--primary); font-size: 0.6rem; border: none; outline: none; cursor: pointer; font-family: var(--font-head);">
                    <option value="ALL">ALL_SYSTEMS</option>
                    <option value="TECH">TECH</option>
                    <option value="BIO">BIO</option>
                    <option value="FINANCE">FINANCE</option>
                    <option value="GLOBAL">GLOBAL</option>
                    <option value="CYBER">CYBER</option>
                </select>
            </div>
            <button onclick="syncNews()" title="Force System Sync" style="background:none; border:none; color:var(--text-muted); cursor:pointer; display:flex; align-items:center; gap:5px;" class="hover:text-white transition-colors">
                <span class="material-symbols-outlined" style="font-size: 18px;">sync</span>
            </button>
            <div id="sync-status" style="font-size: 0.6rem; display: flex; align-items: center; gap: 5px;">
                <span style="color: var(--success); animation: pulse 2s infinite;">●</span>
                <span id="last-sync-time" style="color: var(--text-muted);">SYNCING...</span>
            </div>
            <button onclick="toggleFilters()" style="background:none; border:none; color:var(--text-muted); cursor:pointer;">
                <span class="material-symbols-outlined" style="font-size: 20px;">settings</span>
            </button>
        </div>
    </header>

    <div class="ticker-container">
        <div class="ticker-content" id="global-ticker"></div>
    </div>

    <!-- VIEW: GRID -->
    <section id="view-grid" class="view-section">
        <div class="module-header">
            <h2 class="module-title" id="txt-grid-title">NEURAL_DASHBOARD</h2>
            <div class="module-subtitle" id="txt-grid-subtitle">Real-time Global Surveillance</div>
        </div>

        <div class="world-map-container">
            <div class="map-bg"></div>
            <div id="map-hotspots"></div>
            <div style="position:absolute; bottom:10px; right:10px; font-size:0.5rem; color:var(--text-muted); background:rgba(0,0,0,0.5); padding:4px 8px; border-radius:4px; font-family:var(--font-head);">
                <span style="color:var(--accent);">●</span> ACTIVE_UPLINKS
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
            <div class="glass-panel" style="padding: 12px; height: 100px; border-left: 2px solid var(--primary); overflow:hidden;">
                <div style="font-size: 0.6rem; color: var(--text-muted); margin-bottom: 5px; font-family:var(--font-head);">SYSTEM_LOGS</div>
                <div id="log-stream" style="font-family:monospace; font-size:0.55rem; color:var(--highlight); line-height:1.4;"></div>
            </div>
            <div class="glass-panel" style="padding: 12px; height: 100px; border-right: 2px solid var(--accent);">
                <div style="font-size: 0.6rem; color: var(--text-muted); margin-bottom: 8px; font-family:var(--font-head);">GRID_METRICS</div>
                <div id="metrics-container" style="display: flex; flex-direction: column; gap: 8px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.55rem;"><span>BANDWIDTH</span><span id="bw-pct">0%</span></div>
                    <div style="height:2px; background:#111;"><div id="bw-bar" style="height:100%; width:0%; background:var(--primary);"></div></div>
                    <div style="display:flex; justify-content:space-between; font-size:0.55rem;"><span>STABILITY</span><span id="st-pct">0%</span></div>
                    <div style="height:2px; background:#111;"><div id="st-bar" style="height:100%; width:0%; background:var(--success);"></div></div>
                </div>
            </div>
        </div>

        <h3 class="module-title" style="font-size: 1rem; margin-bottom: 15px; opacity:0.6;" id="txt-latest">LATEST_SIGNALS</h3>
        <div class="news-grid" id="main-feed"></div>
    </section>

    <!-- VIEW: TIME -->
    <section id="view-time" class="view-section hidden">
        <div class="module-header">
            <h2 class="module-title" id="txt-time-title">TEMPORAL_ARCHIVE</h2>
            <div class="module-subtitle" id="txt-time-subtitle">Chronological Data Stream</div>
        </div>

        <div class="glass-panel" style="padding: 15px; margin-bottom: 25px;">
            <div style="font-size: 0.6rem; color: var(--text-muted); margin-bottom: 10px; font-family:var(--font-head);">TEMPORAL_DENSITY</div>
            <div style="display: flex; align-items: flex-end; gap: 4px; height: 40px;" id="time-density">
                <!-- Density bars will be injected -->
            </div>
        </div>

        <div class="timeline-wrapper" id="timeline-feed"></div>
    </section>

    <!-- VIEW: DATA -->
    <section id="view-data" class="view-section hidden">
        <div class="module-header">
            <h2 class="module-title" id="txt-data-title">DATA_VAULT</h2>
            <div class="module-subtitle" id="txt-data-subtitle">Deep Search & Sector Analysis</div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <div id="sector-analysis" class="glass-panel" style="padding: 15px; border-radius: 12px;">
                <div style="font-family: var(--font-head); font-size: 0.6rem; color: var(--text-muted); margin-bottom: 4px;">SECTOR_DISTRIBUTION</div>
                <div style="font-size: 0.5rem; color: #555; margin-bottom: 12px; text-transform: uppercase;">Category density analysis of incoming signals</div>
                <div id="sector-bars" style="display: flex; flex-direction: column; gap: 10px;"></div>
            </div>
            <div class="glass-panel" style="padding: 15px; border-radius: 12px;">
                <div style="font-family: var(--font-head); font-size: 0.6rem; color: var(--text-muted); margin-bottom: 4px;">ENTITY_EXTRACTION</div>
                <div style="font-size: 0.5rem; color: #555; margin-bottom: 12px; text-transform: uppercase;">Key subjects identified in the current stream</div>
                <div id="entity-cloud" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
            </div>
        </div>

        <div style="display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px;">
            <button class="glow-badge active" id="btn-ww" onclick="setRegion('WW')">WORLDWIDE</button>
            <button class="glow-badge" id="btn-de" onclick="setRegion('DE')">GERMANY</button>
        </div>

        <div class="news-grid" id="archive-feed"></div>
    </section>

    <!-- VIEW: DETAIL -->
    <section id="view-detail" class="view-section hidden">
        <div class="detail-hero" id="det-img"></div>
        <div class="detail-body glass-panel" style="border-radius: 20px 20px 0 0;">
            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:15px;">
                <span id="det-cat" class="card-cat">TECH // ARCHIVE</span>
                <div id="det-verified"></div>
            </div>
            <h1 id="det-title" style="font-family: var(--font-head); font-size: 1.5rem; margin-bottom: 20px; line-height: 1.2;"></h1>

            <div class="integrity-scanner">
                <div id="det-integrity-icon" class="material-symbols-outlined" style="color:var(--primary);">security</div>
                <div style="flex:1;">
                    <div id="txt-integrity" style="font-size:0.6rem; color:var(--text-muted); text-transform:uppercase; margin-bottom:5px;">SOURCE_INTEGRITY</div>
                    <div class="scanner-bar"><div id="integrity-fill" class="scanner-fill"></div></div>
                </div>
                <div id="integrity-val" style="font-size:0.7rem; font-weight:700;">0%</div>
            </div>

            <div id="det-content" style="line-height:1.7; color:#ccc; font-size:0.95rem; margin-bottom:20px;"></div>

            <div class="glass-panel" style="padding:15px; margin-bottom:20px;">
                <div id="txt-media" style="font-family: var(--font-head); font-size: 0.6rem; color: var(--text-muted); margin-bottom: 10px;">MEDIA_UPLINKS</div>
                <div id="det-thumbnails" style="display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px;"></div>
            </div>

            <div class="glass-panel" style="padding:15px; margin-bottom:20px; border-left:2px solid var(--accent);">
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:10px;">
                    <span class="material-symbols-outlined" style="font-size:16px; color:var(--accent);">psychology</span>
                    <span style="font-size:0.6rem; color:var(--text-muted); font-family:var(--font-head);">NEURAL_ANALYSIS_GENERATOR</span>
                </div>
                <div id="det-analysis" style="font-size:0.8rem; font-style:italic; color:var(--highlight); line-height:1.5;"></div>
            </div>

            <div style="margin-bottom: 30px; padding: 0 5px;">
                <div style="font-size: 0.55rem; color: var(--text-muted); font-family: var(--font-head); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">Detected_Entities</div>
                <div id="det-entities" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <button class="btn-tech" style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1);" onclick="navTo('grid')" id="txt-back">RETURN</button>
                <a id="det-link" target="_blank" class="btn-tech text-center flex-center" style="text-decoration:none;"><span id="txt-open">OPEN_UPLINK</span></a>
            </div>
        </div>
    </section>
</div>

<nav class="nav-dock">
    <button class="nav-item active" onclick="navTo('grid')" id="nav-grid">
        <span class="material-symbols-outlined">grid_view</span>
        <span id="txt-nav-grid">GRID</span>
    </button>
    <button class="nav-item" onclick="navTo('time')" id="nav-time">
        <span class="material-symbols-outlined">history</span>
        <span id="txt-nav-time">TIME</span>
    </button>
    <button class="nav-item" onclick="navTo('data')" id="nav-data">
        <span class="material-symbols-outlined">folder_open</span>
        <span id="txt-nav-data">DATA</span>
    </button>
</nav>

<!-- MODAL: SETTINGS -->
<div id="modal-settings" class="modal-overlay hidden">
    <div class="modal-content glass-panel">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h3 id="txt-settings" style="font-family:var(--font-head); font-size:1rem; margin:0;">SYSTEM_SETTINGS</h3>
            <button onclick="toggleFilters()" style="background:none; border:none; color:white; cursor:pointer;"><span class="material-symbols-outlined">close</span></button>
        </div>

        <label id="txt-lang-label" style="font-size:0.6rem; color:var(--text-muted);">INTERFACE_LANGUAGE</label>
        <div style="display:flex; gap:10px; margin:10px 0 20px 0;">
            <button class="glow-badge" id="lang-en" onclick="setLanguage('en')">ENGLISH</button>
            <button class="glow-badge" id="lang-de" onclick="setLanguage('de')">DEUTSCH</button>
        </div>

        <label id="txt-theme-label" style="font-size:0.6rem; color:var(--text-muted);">PRIMARY_HUE</label>
        <div style="margin:10px 0 20px 0;">
            <div style="display:flex; justify-content:space-between; font-size:0.7rem; margin-bottom:10px;"><span id="txt-hue-label">HUE_OFFSET</span><span id="hue-display">270</span></div>
            <input type="range" min="0" max="360" value="270" id="hue-slider" oninput="updateHue()" style="width:100%; accent-color:var(--primary);">
        </div>

        <button class="btn-tech" style="width:100%;" onclick="toggleFilters()" id="txt-apply">APPLY_CHANGES</button>
    </div>
</div>

<script>
    /* --- CONFIG & STATE --- */
    const i18n = {
        en: {
            'grid-title': 'NEURAL_DASHBOARD', 'grid-subtitle': 'Real-time Global Surveillance',
            'time-title': 'TEMPORAL_ARCHIVE', 'time-subtitle': 'Chronological Data Stream',
            'data-title': 'DATA_VAULT', 'data-subtitle': 'Deep Search & Sector Analysis',
            'latest': 'LATEST SIGNALS', 'back': 'RETURN', 'open': 'OPEN UPLINK',
            'settings': 'SYSTEM SETTINGS', 'lang-label': 'INTERFACE LANGUAGE',
            'apply': 'APPLY CHANGES', 'nav-grid': 'GRID', 'nav-time': 'TIME', 'nav-data': 'DATA',
            'theme-label': 'PRIMARY HUE', 'hue-label': 'HUE OFFSET',
            'verified': 'NEURAL VERIFIED', 'unverified': 'UNVERIFIED', 'integrity': 'SOURCE INTEGRITY',
            'media': 'MEDIA UPLINKS'
        },
        de: {
            'grid-title': 'NEURAL DASHBOARD', 'grid-subtitle': 'Echtzeit-Globalüberwachung',
            'time-title': 'TEMPORAL ARCHIV', 'time-subtitle': 'Chronologischer Datenstrom',
            'data-title': 'DATEN TRESOR', 'data-subtitle': 'Tiefensuche & Sektor-Analyse',
            'latest': 'NEUESTE SIGNALE', 'back': 'ZURÜCK', 'open': 'UPLINK ÖFFNEN',
            'settings': 'SYSTEM EINSTELLUNGEN', 'lang-label': 'OBERFLÄCHEN SPRACHE',
            'apply': 'ÜBERNEHMEN', 'nav-grid': 'NETZ', 'nav-time': 'ZEIT', 'nav-data': 'DATEN',
            'theme-label': 'PRIMÄR FARBTON', 'hue-label': 'FARB VERSATZ',
            'verified': 'NEURAL VERIFIZIERT', 'unverified': 'UNVERIFIZIERT', 'integrity': 'QUELL INTEGRITÄT',
            'media': 'MEDIEN UPLINKS'
        }
    };

    let state = {
        lang: localStorage.getItem('nexus_lang') || 'en',
        region: localStorage.getItem('nexus_reg') || 'WW',
        hue: localStorage.getItem('nexus_hue') || 270,
        news: [],
        activeView: 'grid'
    };

    /* --- THEME & L10N --- */
    function updateHue() {
        const h = document.getElementById('hue-slider').value;
        state.hue = h;
        localStorage.setItem('nexus_hue', h);
        document.documentElement.style.setProperty('--primary-hue', h);
        document.getElementById('hue-display').innerText = h;
        glitchFlash();
    }

    function setLanguage(l) {
        state.lang = l;
        localStorage.setItem('nexus_lang', l);
        applyL10n();
        glitchFlash();
    }

    function applyL10n() {
        const d = i18n[state.lang];
        for (const [id, val] of Object.entries(d)) {
            const el = document.getElementById('txt-' + id);
            if (el) el.innerText = val;
        }
        document.getElementById('txt-nav-grid').innerText = d['nav-grid'];
        document.getElementById('txt-nav-time').innerText = d['nav-time'];
        document.getElementById('txt-nav-data').innerText = d['nav-data'];
        document.getElementById('lang-en').classList.toggle('active', state.lang === 'en');
        document.getElementById('lang-de').classList.toggle('active', state.lang === 'de');
    }

    /* --- NEWS ENGINE --- */
    const RSS_FEEDS = {
        'WW': 'https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en',
        'DE': 'https://news.google.com/rss?hl=de&gl=DE&ceid=DE:de'
    };

    async function syncNews() {
        const localApi = `/api/news?region=${state.region}`;
        const rssUrl = RSS_FEEDS[state.region];
        const rss2json = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;

        document.getElementById('last-sync-time').innerText = "SYNCING...";
        let success = false;

        try {
            let response = await fetch(localApi);
            if (response.ok) {
                let data = await response.json();
                if (data.items && data.items.length > 0) {
                    processData(data.items);
                    success = true;
                }
            }
        } catch (e) {
            console.warn("Local API offline, trying fallback...");
        }

        if (!success) {
            try {
                let response2 = await fetch(rss2json);
                if (response2.ok) {
                    let data2 = await response2.json();
                    if (data2.items && data2.items.length > 0) {
                        processData(data2.items);
                        success = true;
                    }
                }
            } catch (e) {
                console.error("Fallback sync failed:", e);
            }
        }

        if (!success) {
            document.getElementById('last-sync-time').innerText = "OFFLINE";
            processData(generateMockData());
        } else {
            document.getElementById('last-sync-time').innerText = new Date().toLocaleTimeString();
        }
    }

    function generateMockData() {
        return Array.from({length: 12}).map((_, i) => ({
            title: `[LOST_SIGNAL] NODE_OFFSET_${i} // REESTABLISHING_LINK...`,
            link: "#",
            pubDate: new Date().toISOString(),
            description: "Nexus failed to retrieve live data packets. System is running on emergency cache protocols.",
            source: "EMERGENCY_BROADCAST"
        }));
    }

    function extractKeywords(t) {
        const stops = new Set(['the','and','for','with','this','that','from','google','news','video','says','after','watch','breaking', 'report', 'investigators', 'find', 'update', 'latest']);
        return t.toLowerCase().replace(/[^\w\s]/g,' ').split(/\s+/).filter(w => w.length > 3 && !stops.has(w)).slice(0,3).join(',');
    }

    function getCategory(title) {
        const t = title.toLowerCase();
        if (/(cyber|hack|security|leak|malware|ransomware|breach|exploit|firewall)/i.test(t)) return 'CYBER';
        if (/(tech|ai|robot|digital|software|data|silicon|apple|google|microsoft|nvidia|tesla|musk|spacex|quantum|computing|smartphone|app)/i.test(t)) return 'TECH';
        if (/(climate|environment|bio|health|medical|virus|pandemic|dna|nature|green|energy|oil|gas|ocean|ecology|warming|solar|wind)/i.test(t)) return 'BIO';
        if (/(finance|market|stock|economy|trade|bank|crypto|bitcoin|price|dollar|euro|inflation|interest|fed|nasdaq|dow)/i.test(t)) return 'FINANCE';
        if (/(war|conflict|politics|election|government|china|russia|usa|un|world|crisis|summit|trump|biden|border|senate|parliament|nato)/i.test(t)) return 'GLOBAL';
        return 'INTEL';
    }

    function processData(items) {
        if (!items || !Array.isArray(items)) return;
        state.news = items.slice(0, 30).map((n, i) => {
            const title = n.title || "UNDEFINED_SIGNAL";
            const desc = n.description || "";
            const imgMatch = desc.match(/src="([^"]+)"/);
            const kw = extractKeywords(title);
            const cat = getCategory(title);

            let imgTags = kw ? kw : 'cyberpunk,grid,matrix';
            if (cat === 'CYBER') imgTags = 'hacker,digital,security';
            if (cat === 'BIO') imgTags = 'nature,lab,climate';
            if (cat === 'FINANCE') imgTags = 'trading,numbers,bank';
            if (cat === 'TECH') imgTags = 'hardware,circuit,server';
            if (cat === 'GLOBAL') imgTags = 'city,crowd,politics';

            return {
                id: i,
                title: title,
                link: n.link || "#",
                rawDate: n.pubDate,
                date: n.pubDate ? new Date(n.pubDate).toLocaleDateString() : new Date().toLocaleDateString(),
                region: n.author || n.source || state.region,
                cat: cat,
                img: imgMatch ? imgMatch[1] : `https://loremflickr.com/800/600/${imgTags}/all?lock=${i}`,
                content: desc,
                verified: Math.random() > 0.3,
                integrity: Math.floor(Math.random() * 40) + 60
            };
        });
        renderAll();
        updateSectorAnalysis();
        document.getElementById('last-sync-time').innerText = new Date().toLocaleTimeString();
    }

    function renderAll() {
        renderFeed('main-feed', state.news);
        renderFeed('archive-feed', state.news);
        renderTimeline();
        document.getElementById('global-ticker').innerHTML = state.news.map(n => `<span class="ticker-item">${n.title}</span>`).join('');
        renderHotspots();
    }

    function renderFeed(id, items) {
        const container = document.getElementById(id);
        if (!container) return;
        const d = i18n[state.lang];
        container.innerHTML = items.map(n => `
            <div class="glass-panel news-card" onclick="openDetail(${n.id})">
                <img src="${n.img}" class="news-thumb" onerror="this.src='https://loremflickr.com/800/600/tech/all?lock=${n.id}'">
                <div class="card-body">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span class="card-cat">${n.cat} // ${n.region}</span>
                        <div class="${n.verified ? 'badge-verified' : 'badge-unverified'}">
                            <span class="material-symbols-outlined" style="font-size:10px;">${n.verified ? 'verified_user' : 'report'}</span>
                            ${n.verified ? d['verified'] : d['unverified']}
                        </div>
                    </div>
                    <h4 class="card-title">${n.title}</h4>
                    <div style="font-size:0.6rem; color:var(--text-muted);">${n.date}</div>
                </div>
            </div>
        `).join('');

        gsap.from('#' + id + ' .news-card', { opacity: 0, y: 15, duration: 0.2, stagger: 0.05 });
    }

    function renderTimeline() {
        const c = document.getElementById('timeline-feed');
        c.innerHTML = state.news.map(n => `
            <div class="glass-panel timeline-node" onclick="openDetail(${n.id})">
                <div class="node-dot"></div>
                <div style="font-size:0.7rem; color:var(--primary); margin-bottom:5px;">${n.date} // ${n.cat}</div>
                <h4 style="margin:0; font-size:0.9rem; line-height:1.4;">${n.title}</h4>
            </div>
        `).join('');

        const hours = new Array(24).fill(0);
        state.news.forEach(n => {
            const d = new Date(n.rawDate || Date.now());
            hours[d.getHours()]++;
        });
        const max = Math.max(...hours, 1);

        const d = document.getElementById('time-density');
        d.innerHTML = hours.map(count => {
            const h = (count / max) * 100;
            return `<div style="flex:1; background:var(--primary); opacity:${count > 0 ? 0.8 : 0.1}; height:${Math.max(h, 4)}%; border-radius:1px;"></div>`;
        }).join('');
    }

    function renderHotspots() {
        const c = document.getElementById('map-hotspots');
        c.innerHTML = '';
        for(let i=0; i<5; i++) {
            const div = document.createElement('div');
            div.className = 'hotspot';
            div.style.left = (Math.random()*80 + 10) + '%';
            div.style.top = (Math.random()*60 + 20) + '%';
            div.onclick = () => openDetail(Math.floor(Math.random()*state.news.length));
            c.appendChild(div);
        }
    }

    function updateSectorAnalysis() {
        const counts = {};
        const entities = new Set();
        state.news.forEach(n => {
            counts[n.cat] = (counts[n.cat] || 0) + 1;
            extractKeywords(n.title).split(',').forEach(k => { if(k) entities.add(k.toUpperCase()) });
        });

        const c = document.getElementById('sector-bars');
        c.innerHTML = Object.entries(counts).map(([cat, count]) => {
            const pct = (count / state.news.length) * 100;
            return `
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="width:50px; font-size:0.5rem; color:var(--text-muted);">${cat}</div>
                    <div style="flex:1; height:4px; background:rgba(255,255,255,0.03); position:relative; overflow:hidden;">
                        <div class="sector-fill" style="position:absolute; height:100%; width:0%; background:var(--primary);" data-pct="${pct}"></div>
                    </div>
                    <div style="width:25px; font-size:0.5rem; color:var(--highlight); text-align:right;">${Math.round(pct)}%</div>
                </div>
            `;
        }).join('');
        gsap.to('.sector-fill', { width: (i, el) => el.dataset.pct + '%', duration: 1, ease: "power4.out", stagger: 0.1 });

        const ec = document.getElementById('entity-cloud');
        ec.innerHTML = Array.from(entities).slice(0, 15).map(e => `
            <span style="font-size:0.55rem; color:var(--accent); border:1px solid rgba(138,43,226,0.3); padding:2px 5px; border-radius:2px;">${e}</span>
        `).join('');
    }

    /* --- UI FLOW --- */
    function scrambleText(id, text) {
        const el = document.getElementById(id);
        if (!el) return;
        const chars = '!<>-_\\/[]{}—=+*^?#________';
        let iteration = 0;
        const interval = setInterval(() => {
            el.innerText = text.split('').map((char, index) => {
                if (index < iteration) return text[index];
                return chars[Math.floor(Math.random() * chars.length)];
            }).join('');
            if (iteration >= text.length) clearInterval(interval);
            iteration += 1 / 3;
        }, 30);
    }

    function navTo(v) {
        if (state.activeView === v) return;
        const old = document.getElementById('view-' + state.activeView);
        const target = document.getElementById('view-' + v);

        gsap.to(old, { opacity: 0, scale: 0.98, filter: "blur(5px)", duration: 0.12, onComplete: () => {
            old.classList.add('hidden');
            target.classList.remove('hidden');
            gsap.fromTo(target,
                { opacity: 0, scale: 1.05, filter: "blur(15px)" },
                { opacity: 1, scale: 1, filter: "blur(0px)", duration: 0.12, ease: "power4.out" }
            );
        }});

        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        const navBtn = document.getElementById('nav-' + v);
        if (navBtn) navBtn.classList.add('active');
        state.activeView = v;
        glitchFlash();
        window.scrollTo(0, 0);

        // Scramble titles on nav
        const d = i18n[state.lang];
        if (v === 'grid') {
            scrambleText('txt-grid-title', d['grid-title']);
            scrambleText('txt-grid-subtitle', d['grid-subtitle']);
        }
        if (v === 'time') {
            scrambleText('txt-time-title', d['time-title']);
            scrambleText('txt-time-subtitle', d['time-subtitle']);
        }
        if (v === 'data') {
            scrambleText('txt-data-title', d['data-title']);
            scrambleText('txt-data-subtitle', d['data-subtitle']);
        }
    }

    function generateAnalysis(title, cat) {
        const keywords = extractKeywords(title).split(',').filter(k => k);
        const kw = keywords.length > 0 ? keywords[0].toUpperCase() : 'DATA';

        const templates = {
            'TECH': [
                `Neural pattern detected in ${kw} architecture. Integration status: OPTIMAL.`,
                `Disruption identified in ${kw} semiconductor chains. Long-term impact: CRITICAL.`,
                `AI trajectory for ${kw} suggests rapid evolution. Surveillance protocols active.`,
                `Quantum leap in ${kw} processing confirmed. Neural link established.`
            ],
            'GLOBAL': [
                `Geopolitical shift in ${kw} sector observed. Conflict probability: 34%.`,
                `Resource scarcity driving policy changes regarding ${kw}. Stability index falling.`,
                `Diplomatic noise regarding ${kw} reaching peak threshold. Intercepting streams.`,
                `Strategic realignment detected in ${kw} territory. Tactical analysis required.`
            ],
            'BIO': [
                `Ecological markers for ${kw} exceeding safety thresholds. Bio-hazard level: MINOR.`,
                `Genetic breakthrough in ${kw} synthesis detected. Ethics compliance: OVERRIDDEN.`,
                `Pathogen vector tracking ${kw} patterns. Global quarantine index stable.`,
                `Synthetic evolution of ${kw} confirmed. Monitor metabolic drift.`
            ],
            'FINANCE': [
                `Market volatility in ${kw} expected within 72h. High-frequency trade alert.`,
                `Liquidity event in ${kw} index predicted. Reallocating digital assets.`,
                `De-globalization of ${kw} assets continues. Regional impact: SEVERE.`,
                `Algorithmic stabilization of ${kw} unsuccessful. Fiscal entropy increasing.`
            ],
            'CYBER': [
                `Large-scale breach targeting ${kw} protocols. 5.4M records compromised.`,
                `Sophisticated threat actor 'PHANTOM' linked to ${kw} exploit. Signature verified.`,
                `Infrastructural vulnerability in ${kw} mesh exposed. Deployment of counter-ICE.`,
                `Neural decryption of ${kw} traffic complete. Analyzing encrypted payloads.`
            ],
            'INTEL': [
                `Signal strength for ${kw} uplink optimal. Data integrity: 98.4%.`,
                `Anomaly detected in ${kw} background noise. Deep-packet inspection initiated.`,
                `Targeted extraction of ${kw} data in progress. Contextual relevance: HIGH.`,
                `Cryptographic residue found in ${kw} stream. Origin point: UNDEFINED.`
            ]
        };
        const list = templates[cat] || templates['INTEL'];
        return list[Math.floor(Math.random() * list.length)] + " [REF: " + Math.random().toString(36).substring(2, 8).toUpperCase() + "]";
    }

    function openDetail(id) {
        const n = state.news.find(x => x.id === id);
        if (!n) return;
        const d = i18n[state.lang];

        document.getElementById('det-img').style.backgroundImage = `url(${n.img})`;
        scrambleText('det-title', n.title);
        document.getElementById('det-content').innerHTML = n.content;

        const thumbContainer = document.getElementById('det-thumbnails');
        thumbContainer.innerHTML = '';
        for(let i=0; i<3; i++) {
            const seed = (n.id.toString().charCodeAt(0) + i) * 10;
            const img = document.createElement('div');
            img.style.width = '100px';
            img.style.height = '60px';
            img.style.borderRadius = '4px';
            img.style.flexShrink = '0';
            img.style.backgroundImage = `url(https://picsum.photos/seed/${seed}/200/120)`;
            img.style.backgroundSize = 'cover';
            img.style.border = '1px solid var(--primary)';
            img.style.opacity = '0.7';
            thumbContainer.appendChild(img);
        }

        const analysisText = generateAnalysis(n.title, n.cat);
        scrambleText('det-analysis', analysisText);

        const keywords = extractKeywords(n.title).split(',').filter(k => k);
        const entityContainer = document.getElementById('det-entities');
        entityContainer.innerHTML = keywords.map(kw => `
            <span class="glow-badge" style="font-size: 0.5rem; border-color: var(--primary); color: var(--highlight);">${kw.toUpperCase()}</span>
        `).join('');

        document.getElementById('det-cat').innerText = `${n.cat} // ${n.region}`;
        document.getElementById('det-link').href = n.link;

        const v = document.getElementById('det-verified');
        v.innerHTML = `<div class="${n.verified ? 'badge-verified' : 'badge-unverified'}">${n.verified ? d['verified'] : d['unverified']}</div>`;

        navTo('detail');

        // Animate Integrity Bar
        const bar = document.getElementById('integrity-fill');
        const val = document.getElementById('integrity-val');
        const icon = document.getElementById('det-integrity-icon');

        gsap.set(bar, { width: "0%" });
        gsap.to(bar, { width: n.integrity + "%", duration: 1.5, ease: "power2.out" });

        let counter = { val: 0 };
        gsap.to(counter, { val: n.integrity, duration: 1.5, onUpdate: () => {
            val.innerText = Math.floor(counter.val) + "%";
            if (counter.val > 80) icon.style.color = "var(--success)";
            else if (counter.val < 70) icon.style.color = "var(--alert)";
        }});
    }

    function setRegion(r) {
        state.region = r;
        localStorage.setItem('nexus_reg', r);
        document.getElementById('btn-ww').classList.toggle('active', r === 'WW');
        document.getElementById('btn-de').classList.toggle('active', r === 'DE');
        syncNews();
        glitchFlash();
    }

    function toggleFilters() {
        document.getElementById('modal-settings').classList.toggle('hidden');
    }

    function filterByCategory(cat) {
        if (cat === 'ALL') {
            renderFeed('main-feed', state.news);
        } else {
            const filtered = state.news.filter(n => n.cat === cat);
            renderFeed('main-feed', filtered);
        }
        glitchFlash();
    }

    function glitchFlash() {
        const g = document.getElementById('global-glitch');
        gsap.fromTo(g, { opacity: 0.3 }, { opacity: 0, duration: 0.2 });
    }

    /* --- INITIALIZATION --- */
    window.onload = () => {
        // Start sync immediately
        syncNews();

        // Boot Sequence
        const log = document.getElementById('boot-log');
        const lines = [
            'CORE_INITIALIZE...', 'KERN_MEM_ALLOC: 0x8FA2', 'DRV_LOAD: NEURAL_LINK',
            'UPLINK_ESTABLISH: GOOGLE_SEARCH_GRID', 'DECIPHER_STREAMS...', 'SYNC_COMPLETED', 'READY.'
        ];
        let i = 0;
        const interval = setInterval(() => {
            if(i >= lines.length) {
                clearInterval(interval);
                gsap.to('#boot-bar', { width: "100%", duration: 0.1, onComplete: () => {
                    gsap.to('#boot-loader', { opacity: 0, duration: 0.15, onComplete: () => {
                        const loader = document.getElementById('boot-loader');
                        if (loader) loader.remove();
                        const d = i18n[state.lang];
                        scrambleText('txt-grid-title', d['grid-title']);
                        scrambleText('txt-grid-subtitle', d['grid-subtitle']);
                    }});
                }});
            } else {
                const div = document.createElement('div');
                div.innerText = `> ${lines[i]}`;
                log.appendChild(div);
                log.scrollTop = log.scrollHeight;
                i++;
            }
        }, 40);

        // Grid Metrics Animation
        gsap.to('#bw-bar', { width: "84%", duration: 2, repeat: -1, yoyo: true });
        gsap.to('#st-bar', { width: "98%", duration: 3, repeat: -1, yoyo: true });

        let mCounter = 0;
        setInterval(() => {
            mCounter = (mCounter + 1) % 100;
            document.getElementById('bw-pct').innerText = (80 + Math.floor(Math.random()*10)) + "%";
            document.getElementById('st-pct').innerText = (95 + Math.floor(Math.random()*5)) + "%";

            const logS = document.getElementById('log-stream');
            const d = document.createElement('div');
            d.innerText = `[${new Date().toLocaleTimeString()}] INCOMING_SIGNAL_${Math.floor(Math.random()*999)}... OK`;
            logS.appendChild(d);
            if(logS.children.length > 5) logS.removeChild(logS.firstChild);
        }, 2000);

        applyL10n();
        updateHue();

        // Global click effect for snappiness
        document.addEventListener('click', (e) => {
            if (e.target.closest('button, .news-card, .nav-item, .glow-badge, a')) {
                glitchFlash();
            }
        });

        // Auto Sync every 30m
        setInterval(syncNews, 30 * 60 * 1000);
    };
</script>
</body>
</html>
