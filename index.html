<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS // GLOBAL NEWS GRID</title>

    <!-- External Assets: Google Fonts & Material Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />

    <!-- GSAP for High-End Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* --- CORE VARIABLES & THEME --- */
        :root {
            --primary-hue: 270;
            --bg-deep: #050505;
            --bg-dark: #0a0a0a;
            --bg-panel: rgba(20, 20, 20, 0.6);

            --scanline-opacity: 0.1;
            --glitch-intensity: 0.5;

            --primary: hsl(var(--primary-hue), 70%, 53%);
            --accent: hsl(calc(var(--primary-hue) + 20), 90%, 53%);
            --highlight: #E0B0FF;
            --alert: #FF003C;
            --success: #00F0FF;

            --text-main: #FFFFFF;
            --text-muted: #A0A0A0;

            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-blur: blur(16px);

            --shadow-neon: 0 0 10px hsla(var(--primary-hue), 70%, 53%, 0.5), 0 0 20px hsla(var(--primary-hue), 70%, 53%, 0.3);
            --shadow-alert: 0 0 15px rgba(255, 0, 60, 0.6);

            --font-head: 'Orbitron', sans-serif;
            --font-body: 'Rajdhani', sans-serif;

            --ease-tech: cubic-bezier(0.19, 1, 0.22, 1);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow-x: hidden;
            background-image:
                linear-gradient(hsla(var(--primary-hue), 70%, 53%, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, hsla(var(--primary-hue), 70%, 53%, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            min-height: 100vh;
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 2px; }

        .hidden { display: none !important; }
        .flex-center { display: flex; justify-content: center; align-items: center; }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
            border-top: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .scanline-effect {
            position: fixed; inset: 0; width: 100%; height: 2px;
            background: var(--primary); opacity: var(--scanline-opacity);
            pointer-events: none !important; z-index: 10000;
            animation: scanline 8s linear infinite;
        }
        @keyframes scanline { 0% { transform: translateY(-100vh); } 100% { transform: translateY(100vh); } }

        @keyframes boot-fade { 0% { opacity: 1; } 100% { opacity: 0; visibility: hidden; } }
        #boot-loader.auto-hide { animation: boot-fade 0.5s forwards; }

        .static-overlay {
            position: fixed; inset: 0;
            background: url('https://media.giphy.com/media/oEI9uWUqWMrBK/giphy.gif');
            background-size: cover; opacity: 0;
            pointer-events: none !important; z-index: 10001;
            mix-blend-mode: screen;
        }

        #app {
            max-width: 1200px;
            margin: 0 auto;
            padding-bottom: 90px;
            position: relative;
            z-index: 10;
        }

        .top-bar {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(5, 5, 5, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .brand { font-family: var(--font-head); font-weight: 900; letter-spacing: 2px; font-size: 1.3rem; }
        .brand span { color: var(--primary); }

        .nav-dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            height: 60px;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--text-muted); background: none; border: none; cursor: pointer;
            width: 100%; height: 100%; transition: 0.15s var(--ease-tech); position: relative;
        }
        .nav-item.active { color: var(--text-main); }
        .nav-item.active .material-symbols-outlined { color: var(--primary); text-shadow: 0 0 10px var(--primary); }
        .nav-item span { font-size: 9px; font-weight: 700; letter-spacing: 1px; margin-top: 2px; }

        .view-section { padding: 20px; }

        .module-header { margin-bottom: 20px; border-left: 3px solid var(--primary); padding-left: 15px; }
        .module-title { font-family: var(--font-head); font-size: 1.5rem; margin: 0; letter-spacing: 1px; }
        .module-subtitle { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; }

        .world-map-container {
            position: relative; height: 240px; border-radius: 12px; overflow: hidden; margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.05);
            background: radial-gradient(circle at center, hsla(var(--primary-hue), 50%, 15%, 0.5) 0%, var(--bg-deep) 100%);
        }
        .map-bg {
            width: 100%; height: 100%;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/ec/World_map_blank_without_borders.svg/2000px-World_map_blank_without_borders.svg.png');
            background-size: cover; background-position: center;
            filter: invert(1) hue-rotate(240deg) brightness(0.4) opacity(0.3);
            mix-blend-mode: screen;
        }
        .hotspot {
            position: absolute; width: 6px; height: 6px; background: var(--accent); border-radius: 50%;
            box-shadow: 0 0 8px var(--accent); cursor: pointer; transform: translate(-50%, -50%);
        }
        .hotspot::before {
            content: ''; position: absolute; inset: -4px; border: 1px solid var(--accent); border-radius: 50%;
            animation: ripple 2s infinite ease-out;
        }
        @keyframes ripple { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }

        .news-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .news-card {
            border-radius: 10px; overflow: hidden; cursor: pointer; position: relative;
            border: 1px solid rgba(255,255,255,0.05);
            transition: transform 0.1s var(--ease-tech), border-color 0.1s var(--ease-tech);
        }
        .news-card:hover {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(var(--primary-hue), 70%, 53%, 0.15);
            transform: translateY(-4px);
        }

        .news-thumb {
            height: 150px; width: 100%; object-fit: cover;
            filter: grayscale(100%) contrast(1.2) brightness(0.7);
            transition: filter 0.3s var(--ease-tech), transform 0.3s var(--ease-tech);
        }
        .news-card:hover .news-thumb { filter: grayscale(0%) contrast(1) brightness(1); transform: scale(1.05); }
        .card-body { padding: 15px; }
        .card-cat { font-size: 9px; font-weight: 700; color: var(--accent); text-transform: uppercase; margin-bottom: 6px; display: block; }
        .card-title { font-family: var(--font-head); font-size: 1rem; margin: 0 0 8px 0; line-height: 1.3; height: 2.6rem; overflow: hidden; }

        .ticker-container { width: 100%; background: rgba(5,5,5,0.9); border-bottom: 1px solid rgba(255,255,255,0.05); overflow: hidden; white-space: nowrap; padding: 6px 0; }
        .ticker-content { display: inline-block; padding-left: 100%; animation: ticker 60s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 30px; font-size: 0.75rem; color: var(--text-muted); font-weight: 500; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        .btn-tech {
            padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 4px;
            font-family: var(--font-head); font-size: 0.7rem; font-weight: 700; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px; transition: 0.15s;
        }
        .btn-tech:hover { background: var(--accent); box-shadow: var(--shadow-neon); }

        .glow-badge {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-muted); padding: 5px 12px; border-radius: 20px; font-size: 0.65rem;
            font-weight: 700; cursor: pointer; transition: 0.15s;
        }
        .glow-badge.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: var(--shadow-neon); }

        .timeline-wrapper { position: relative; padding-left: 20px; border-left: 1px solid rgba(255,255,255,0.1); }
        .timeline-node { margin-bottom: 25px; position: relative; padding: 15px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .timeline-node:hover { background: rgba(255,255,255,0.03); border-color: var(--primary); }
        .node-dot { position: absolute; left: -24.5px; top: 20px; width: 8px; height: 8px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 8px var(--accent); }

        /* Detail View */
        .detail-hero { height: 35vh; background-size: cover; background-position: center; position: relative; overflow: hidden; }
        .detail-hero::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to bottom, transparent, var(--bg-deep)); }
        .detail-body { padding: 30px 20px; margin-top: -50px; position: relative; z-index: 20; }

        .integrity-scanner {
            margin: 20px 0; padding: 15px; border-radius: 8px; background: rgba(0,0,0,0.3);
            border: 1px dashed rgba(255,255,255,0.1); display: flex; align-items: center; gap: 15px;
        }
        .scanner-bar { flex: 1; height: 2px; background: #222; position: relative; overflow: hidden; }
        .scanner-fill { position: absolute; left: 0; top: 0; height: 100%; width: 0%; background: var(--primary); }

        .badge-verified {
            display: flex; align-items: center; gap: 4px; font-size: 8px; font-weight: 800;
            color: var(--success); background: rgba(0, 240, 255, 0.1); border: 1px solid var(--success);
            padding: 2px 6px; border-radius: 3px;
        }
        .badge-unverified {
            display: flex; align-items: center; gap: 4px; font-size: 8px; font-weight: 800;
            color: var(--alert); background: rgba(255, 0, 60, 0.1); border: 1px solid var(--alert);
            padding: 2px 6px; border-radius: 3px;
        }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000;
            display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px);
        }
        .modal-content { width: 90%; max-width: 400px; padding: 25px; border-radius: 12px; }

        #network-canvas { position: fixed; inset: 0; pointer-events: none; opacity: 0.3; z-index: 1; }

        @media (max-width: 640px) {
            .brand { font-size: 1.1rem; }
            .news-grid { grid-template-columns: 1fr; }
            .detail-hero { height: 25vh; }
        }

        .pulse-box {
            animation: pulse-glow 2s infinite ease-in-out;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px var(--primary); }
            50% { box-shadow: 0 0 15px var(--primary); }
        }

        #retry-overlay {
            position: fixed; bottom: 100px; right: 20px; z-index: 500;
            display: flex; flex-direction: column; gap: 10px;
        }
    </style>
</head>
<body>

<canvas id="network-canvas"></canvas>
<div class="scanline-effect"></div>
<div class="static-overlay" id="global-glitch"></div>

<div id="boot-loader" style="position:fixed; inset:0; background:#000; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:var(--font-head); overflow:hidden;">
    <div id="boot-status" style="color:var(--primary); font-size:0.7rem; margin-bottom:10px; font-weight:700;">NEXUS_OS // NEURAL_HANDSHAKE</div>
    <div id="boot-log" style="color:#333; font-size:0.5rem; text-align:center; height:60px; overflow:hidden; font-family:monospace; line-height:1.5;"></div>
    <div style="width:150px; height:1px; background:#111; margin-top:20px; position:relative;">
        <div id="boot-bar" style="position:absolute; inset:0; background:var(--primary); width:0%;"></div>
    </div>
</div>

<div id="alert-breaking" class="modal-overlay hidden" style="z-index: 5000; background: rgba(0,0,0,0.85); backdrop-filter: blur(20px);">
    <div class="modal-content glass-panel" style="border: 1px solid var(--alert); box-shadow: var(--shadow-alert); max-width: 450px;">
        <div style="display:flex; align-items:center; gap:10px; color:var(--alert); font-family:var(--font-head); font-weight:900; margin-bottom:15px; font-size: 0.8rem;">
            <span class="material-symbols-outlined" style="animation: pulse 1s infinite; font-size: 20px;">priority_high</span>
            <span id="txt-alert-head">CRITICAL_SIGNAL_DETECTED</span>
        </div>
        <h2 id="alert-title" style="font-family:var(--font-head); font-size:1.1rem; line-height:1.3; margin-bottom:25px; color: white;"></h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <button class="btn-tech" style="background:var(--alert); border-radius: 2px;" id="alert-btn-view">INTERCEPT</button>
            <button class="btn-tech" style="background:rgba(255,255,255,0.05); border-radius: 2px;" onclick="closeAlert()">DISMISS</button>
        </div>
    </div>
</div>

<div id="retry-overlay" class="hidden">
    <div class="glass-panel" style="padding: 10px 15px; border-left: 2px solid var(--alert); display: flex; align-items: center; gap: 10px;">
        <span style="font-size: 0.6rem; color: var(--text-muted);">SIGNAL_LOST</span>
        <button class="btn-tech" style="padding: 4px 10px; font-size: 0.6rem;" onclick="syncNews()">RE-ACQUIRE</button>
    </div>
</div>

<div id="app">
    <header class="top-bar">
        <div class="brand">NEXUS<span>//</span>GRID</div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div id="sync-container" style="display: flex; align-items: center; gap: 8px; cursor: pointer;" onclick="syncNews()">
                <span class="material-symbols-outlined" id="sync-icon" style="font-size: 18px; color: var(--text-muted);">sync</span>
                <div id="sync-status" style="font-size: 0.6rem; display: flex; align-items: center; gap: 5px;">
                    <span id="last-sync-time" style="color: var(--text-muted);">INITIALIZING...</span>
                </div>
            </div>
            <button onclick="toggleFilters()" style="background:none; border:none; color:var(--text-muted); cursor:pointer;">
                <span class="material-symbols-outlined" style="font-size: 20px;">settings</span>
            </button>
        </div>
    </header>

    <div class="ticker-container">
        <div class="ticker-content" id="global-ticker"></div>
    </div>

    <!-- VIEW: GRID -->
    <section id="view-grid" class="view-section">
        <div class="module-header">
            <h2 class="module-title" id="txt-grid-title">NEURAL_DASHBOARD</h2>
            <div class="module-subtitle" id="txt-grid-subtitle">Real-time Global Surveillance</div>
        </div>

        <div class="world-map-container">
            <div class="map-bg"></div>
            <div id="map-hotspots"></div>
            <div style="position:absolute; bottom:10px; left:10px; font-size:0.5rem; color:var(--text-muted); background:rgba(0,0,0,0.5); padding:4px 8px; border-radius:4px; font-family:var(--font-head);">
                LAT: <span id="map-lat">0.0</span> LNG: <span id="map-lng">0.0</span>
            </div>
            <div style="position:absolute; bottom:10px; right:10px; font-size:0.5rem; color:var(--text-muted); background:rgba(0,0,0,0.5); padding:4px 8px; border-radius:4px; font-family:var(--font-head);">
                <span style="color:var(--accent);">●</span> ACTIVE_UPLINKS
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
            <div class="glass-panel" style="padding: 12px; height: 100px; border-left: 2px solid var(--primary); overflow:hidden;">
                <div style="font-size: 0.6rem; color: var(--text-muted); margin-bottom: 5px; font-family:var(--font-head);">SYSTEM_LOGS</div>
                <div id="log-stream" style="font-family:monospace; font-size:0.55rem; color:var(--highlight); line-height:1.4;"></div>
            </div>
            <div class="glass-panel" style="padding: 12px; height: 100px; border-right: 2px solid var(--accent);">
                <div style="font-size: 0.6rem; color: var(--text-muted); margin-bottom: 8px; font-family:var(--font-head);">GRID_METRICS</div>
                <div id="metrics-container" style="display: flex; flex-direction: column; gap: 8px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.55rem;"><span>BANDWIDTH</span><span id="bw-pct">0%</span></div>
                    <div style="height:2px; background:#111;"><div id="bw-bar" style="height:100%; width:0%; background:var(--primary);"></div></div>
                    <div style="display:flex; justify-content:space-between; font-size:0.55rem;"><span>STABILITY</span><span id="st-pct">0%</span></div>
                    <div style="height:2px; background:#111;"><div id="st-bar" style="height:100%; width:0%; background:var(--success);"></div></div>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 20px;">
            <div class="glass-panel" style="padding: 15px; display: flex; flex-direction: column; gap: 10px;">
                <div style="font-family: var(--font-head); font-size: 0.6rem; color: var(--primary);">SYSTEM_RESOURCES</div>
                <div style="flex: 1; display: flex; flex-direction: column; gap: 8px; justify-content: center;">
                    <div style="display: flex; justify-content: space-between; font-size:0.6rem;"><span>TRAFFIC</span><span style="color:var(--highlight)" id="stat-uplink">4.2 TB/s</span></div>
                    <div class="scanner-bar"><div id="bar-uplink" class="scanner-fill" style="width: 65%;"></div></div>
                    <div style="display: flex; justify-content: space-between; font-size:0.6rem;"><span>LATENCY</span><span style="color:var(--highlight)" id="stat-latency">12ms</span></div>
                    <div class="scanner-bar"><div id="bar-latency" class="scanner-fill" style="width: 12%; background: var(--success);"></div></div>
                </div>
            </div>
            <div class="glass-panel" style="padding: 15px; position: relative; overflow: hidden;">
                <div style="font-family: var(--font-head); font-size: 0.6rem; color: var(--primary); margin-bottom: 10px;">ENVIRONMENT_MONITOR</div>
                <div id="env-chart" style="display: flex; align-items: flex-end; gap: 2px; height: 60px;"></div>
                <div style="position: absolute; right: 10px; top: 10px; font-size: 10px; color: var(--success); display: flex; align-items: center; gap: 4px;">
                    <span class="material-symbols-outlined" style="font-size: 12px; animation: pulse 1s infinite;">sensors</span>
                    LIVE_FEED
                </div>
            </div>
        </div>

        <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
            <h3 class="module-title" style="font-size: 1rem; opacity:0.6;" id="txt-latest">LATEST_SIGNALS</h3>
            <div style="display:flex; align-items:center; gap:10px;">
                <div id="signal-strength" style="display:flex; gap:2px; align-items:flex-end; height:12px;">
                    <div style="width:2px; height:4px; background:var(--success);"></div>
                    <div style="width:2px; height:6px; background:var(--success);"></div>
                    <div style="width:2px; height:8px; background:var(--success);"></div>
                    <div style="width:2px; height:10px; background:var(--success);"></div>
                    <div style="width:2px; height:12px; background:var(--success);"></div>
                </div>
                <select id="sector-filter" onchange="filterByCategory(this.value)" style="background: rgba(255,255,255,0.05); color: var(--primary); font-size: 0.6rem; border: 1px solid rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 4px; outline: none; cursor: pointer; font-family: var(--font-head);">
                    <option value="ALL">ALL_SYSTEMS</option>
                    <option value="TECH">TECH</option>
                    <option value="BIO">BIO</option>
                    <option value="FINANCE">FINANCE</option>
                    <option value="GLOBAL">GLOBAL</option>
                    <option value="CYBER">CYBER</option>
                </select>
            </div>
        </div>
        <div class="news-grid" id="main-feed"></div>
    </section>

    <!-- VIEW: TIME -->
    <section id="view-time" class="view-section hidden">
        <div class="module-header">
            <h2 class="module-title" id="txt-time-title">TEMPORAL_ARCHIVE</h2>
            <div class="module-subtitle" id="txt-time-subtitle">Chronological Data Stream</div>
        </div>

        <div class="glass-panel" style="padding: 15px; margin-bottom: 25px;">
            <div style="font-size: 0.6rem; color: var(--text-muted); margin-bottom: 10px; font-family:var(--font-head);">TEMPORAL_DENSITY</div>
            <div style="display: flex; align-items: flex-end; gap: 4px; height: 40px;" id="time-density"></div>
        </div>

        <div class="timeline-wrapper" id="timeline-feed"></div>
    </section>

    <!-- VIEW: DATA -->
    <section id="view-data" class="view-section hidden">
        <div class="module-header">
            <h2 class="module-title" id="txt-data-title">DATA_VAULT</h2>
            <div class="module-subtitle" id="txt-data-subtitle">Deep Search & Sector Analysis</div>
        </div>

        <div class="glass-panel" style="margin-bottom: 20px; padding: 12px 15px; display: flex; align-items: center; gap: 10px; border-radius: 12px;">
            <span class="material-symbols-outlined" style="color: var(--primary); font-size: 18px;">search</span>
            <input type="text" id="vault-search" placeholder="FILTER_NEURAL_STREAMS..."
                   style="background: transparent; border: none; color: white; flex: 1; font-family: var(--font-body); font-size: 1rem; outline: none;"
                   oninput="filterVault()">
        </div>

        <div style="display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px;">
            <button class="glow-badge active" id="btn-ww" onclick="setRegion('WW')">WW</button>
            <button class="glow-badge" id="btn-de" onclick="setRegion('DE')">DE</button>
            <button class="glow-badge" id="btn-uk" onclick="setRegion('UK')">UK</button>
            <button class="glow-badge" id="btn-fr" onclick="setRegion('FR')">FR</button>
            <button class="glow-badge" id="btn-jp" onclick="setRegion('JP')">JP</button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
            <div id="sector-analysis" class="glass-panel" style="padding: 15px; border-radius: 12px;">
                <div style="font-family: var(--font-head); font-size: 0.6rem; color: var(--text-muted); margin-bottom: 12px;">SECTOR_DISTRIBUTION</div>
                <div id="sector-bars" style="display: flex; flex-direction: column; gap: 10px;"></div>
            </div>
            <div class="glass-panel" style="padding: 15px; border-radius: 12px;">
                <div style="font-family: var(--font-head); font-size: 0.6rem; color: var(--text-muted); margin-bottom: 12px;">ENTITY_EXTRACTION</div>
                <div id="entity-cloud" style="display: flex; flex-wrap: wrap; gap: 8px; align-items: center; justify-content: center; min-height: 80px;"></div>
            </div>
        </div>

        <div class="news-grid" id="archive-feed"></div>
    </section>

    <!-- VIEW: DETAIL -->
    <section id="view-detail" class="view-section hidden">
        <div class="detail-hero" id="det-img"></div>
        <div class="detail-body glass-panel" style="border-radius: 20px 20px 0 0;">
            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:15px;">
                <span id="det-cat" class="card-cat">TECH // ARCHIVE</span>
                <div id="det-verified"></div>
            </div>
            <h1 id="det-title" style="font-family: var(--font-head); font-size: 1.5rem; margin-bottom: 20px; line-height: 1.2;"></h1>

            <div class="integrity-scanner">
                <div id="det-integrity-icon" class="material-symbols-outlined" style="color:var(--primary);">security</div>
                <div style="flex:1;">
                    <div id="txt-integrity" style="font-size:0.6rem; color:var(--text-muted); text-transform:uppercase; margin-bottom:5px;">SOURCE_INTEGRITY</div>
                    <div class="scanner-bar"><div id="integrity-fill" class="scanner-fill"></div></div>
                </div>
                <div id="integrity-val" style="font-size:0.7rem; font-weight:700;">0%</div>
            </div>

            <div id="det-content" style="line-height:1.7; color:#ccc; font-size:0.95rem; margin-bottom:25px;"></div>

            <div class="glass-panel" style="padding:15px; margin-bottom:20px;">
                <div id="txt-media" style="font-family: var(--font-head); font-size: 0.6rem; color: var(--text-muted); margin-bottom: 12px;">MEDIA_UPLINKS</div>
                <div id="media-uplinks-container" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;"></div>
            </div>

            <div class="glass-panel" style="padding:15px; margin-bottom:25px; border-left:2px solid var(--accent);">
                <div style="display:flex; align-items:center; gap:8px; margin-bottom:10px;">
                    <span class="material-symbols-outlined" style="font-size:16px; color:var(--accent);">psychology</span>
                    <span style="font-size:0.6rem; color:var(--text-muted); font-family:var(--font-head);">NEURAL_ANALYSIS_GENERATOR</span>
                </div>
                <div id="det-analysis" style="font-size:0.85rem; font-style:italic; color:var(--highlight); line-height:1.5;"></div>
            </div>

            <div style="margin-bottom: 30px;">
                <div style="font-size: 0.55rem; color: var(--text-muted); font-family: var(--font-head); margin-bottom: 12px; text-transform: uppercase;">Detected_Entities</div>
                <div id="det-entities" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <button class="btn-tech" style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1);" onclick="navTo('grid')" id="txt-back">RETURN</button>
                <a id="det-link" target="_blank" class="btn-tech text-center flex-center" style="text-decoration:none;"><span id="txt-open">OPEN_UPLINK</span></a>
            </div>
        </div>
    </section>
</div>

<nav class="nav-dock">
    <button class="nav-item active" onclick="navTo('grid')" id="nav-grid">
        <span class="material-symbols-outlined">grid_view</span>
        <span id="txt-nav-grid">GRID</span>
    </button>
    <button class="nav-item" onclick="navTo('time')" id="nav-time">
        <span class="material-symbols-outlined">history</span>
        <span id="txt-nav-time">TIME</span>
    </button>
    <button class="nav-item" onclick="navTo('data')" id="nav-data">
        <span class="material-symbols-outlined">folder_open</span>
        <span id="txt-nav-data">DATA</span>
    </button>
</nav>

<!-- MODAL: SETTINGS -->
<div id="modal-settings" class="modal-overlay hidden">
    <div class="modal-content glass-panel">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h3 id="txt-settings" style="font-family:var(--font-head); font-size:1rem; margin:0;">SYSTEM_SETTINGS</h3>
            <button onclick="toggleFilters()" style="background:none; border:none; color:white; cursor:pointer;"><span class="material-symbols-outlined">close</span></button>
        </div>

        <label id="txt-lang-label" style="font-size:0.6rem; color:var(--text-muted);">INTERFACE_LANGUAGE</label>
        <div style="display:flex; gap:10px; margin:10px 0 20px 0;">
            <button class="glow-badge" id="lang-en" onclick="setLanguage('en')">ENGLISH</button>
            <button class="glow-badge" id="lang-de" onclick="setLanguage('de')">DEUTSCH</button>
        </div>

        <label id="txt-theme-label" style="font-size:0.6rem; color:var(--text-muted);">PRIMARY_HUE</label>
        <div style="margin:10px 0 20px 0;">
            <div style="display:flex; justify-content:space-between; font-size:0.7rem; margin-bottom:10px;"><span id="txt-hue-label">HUE_OFFSET</span><span id="hue-display">270</span></div>
            <input type="range" min="0" max="360" value="270" id="hue-slider" oninput="updateHue()" style="width:100%; accent-color:var(--primary);">
        </div>

        <button class="btn-tech" style="width:100%;" onclick="toggleFilters()" id="txt-apply">APPLY_CHANGES</button>
    </div>
</div>

<script>
    /* --- UTILITIES --- */
    function escapeHTML(str) {
        if (!str) return "";
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
    }

    /* --- CONFIG & STATE --- */
    const i18n = {
        en: {
            'grid-title': 'NEURAL_DASHBOARD', 'grid-subtitle': 'Real-time Global Surveillance',
            'time-title': 'TEMPORAL_ARCHIVE', 'time-subtitle': 'Chronological Data Stream',
            'data-title': 'DATA_VAULT', 'data-subtitle': 'Deep Search & Sector Analysis',
            'latest': 'LATEST SIGNALS', 'back': 'RETURN', 'open': 'OPEN UPLINK',
            'settings': 'SYSTEM SETTINGS', 'lang-label': 'INTERFACE LANGUAGE',
            'apply': 'APPLY CHANGES', 'nav-grid': 'GRID', 'nav-time': 'TIME', 'nav-data': 'DATA',
            'theme-label': 'PRIMARY HUE', 'hue-label': 'HUE OFFSET',
            'verified': 'NEURAL VERIFIED', 'unverified': 'UNVERIFIED', 'integrity': 'SOURCE INTEGRITY',
            'media': 'MEDIA UPLINKS', 'alert-head': 'CRITICAL SIGNAL DETECTED'
        },
        de: {
            'grid-title': 'NEURAL DASHBOARD', 'grid-subtitle': 'Echtzeit-Globalüberwachung',
            'time-title': 'TEMPORAL ARCHIV', 'time-subtitle': 'Chronologischer Datenstrom',
            'data-title': 'DATEN TRESOR', 'data-subtitle': 'Tiefensuche & Sektor-Analyse',
            'latest': 'NEUESTE SIGNALE', 'back': 'ZURÜCK', 'open': 'UPLINK ÖFFNEN',
            'settings': 'SYSTEM EINSTELLUNGEN', 'lang-label': 'OBERFLÄCHEN SPRACHE',
            'apply': 'ÜBERNEHMEN', 'nav-grid': 'NETZ', 'nav-time': 'ZEIT', 'nav-data': 'DATEN',
            'theme-label': 'PRIMÄR FARBTON', 'hue-label': 'FARB VERSATZ',
            'verified': 'NEURAL VERIFIZIERT', 'unverified': 'UNVERIFIZIERT', 'integrity': 'QUELL INTEGRITÄT',
            'media': 'MEDIEN UPLINKS', 'alert-head': 'KRITISCHES SIGNAL ENTDECKT'
        }
    };

    let state = {
        lang: localStorage.getItem('nexus_lang') || 'en',
        region: localStorage.getItem('nexus_reg') || 'WW',
        hue: localStorage.getItem('nexus_hue') || 270,
        news: [],
        activeView: 'grid',
        failCount: 0
    };

    /* --- THEME & L10N --- */
    function updateHue() {
        const slider = document.getElementById('hue-slider');
        if (!slider) return;
        const h = slider.value;
        state.hue = h;
        localStorage.setItem('nexus_hue', h);
        document.documentElement.style.setProperty('--primary-hue', h);
        const display = document.getElementById('hue-display');
        if (display) display.innerText = h;
    }

    function setLanguage(l) {
        state.lang = l;
        localStorage.setItem('nexus_lang', l);
        applyL10n();
        glitchFlash();
    }

    function applyL10n() {
        const d = i18n[state.lang];
        for (const [id, val] of Object.entries(d)) {
            const el = document.getElementById('txt-' + id);
            if (el) el.innerText = val;
        }
        document.getElementById('txt-nav-grid').innerText = d['nav-grid'];
        document.getElementById('txt-nav-time').innerText = d['nav-time'];
        document.getElementById('txt-nav-data').innerText = d['nav-data'];
        document.getElementById('lang-en').classList.toggle('active', state.lang === 'en');
        document.getElementById('lang-de').classList.toggle('active', state.lang === 'de');
    }

    /* --- NEWS ENGINE --- */
    async function syncNews() {
        const icon = document.getElementById('sync-icon');
        if (typeof gsap !== 'undefined') {
            gsap.to(icon, { rotation: "+=360", duration: 1, repeat: 1, ease: "power1.inOut" });
        }

        document.getElementById('last-sync-time').innerText = "SYNCING...";
        document.getElementById('retry-overlay').classList.add('hidden');

        // Primary Attempt: Local Proxy
        try {
            const localApi = `/api/news?region=${state.region}`;
            let response = await fetch(localApi);
            if (response.ok) {
                let data = await response.json();
                if (data.items && data.items.length > 0) {
                    processData(data.items);
                    document.getElementById('last-sync-time').innerText = new Date().toLocaleTimeString();
                    state.failCount = 0;
                    return;
                }
            }
        } catch (e) { console.warn("Local sync failed, trying fallback..."); }

        // Fallback Attempt: rss2json
        try {
            const rss_urls = {
                'WW': 'https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en',
                'DE': 'https://news.google.com/rss?hl=de&gl=DE&ceid=DE:de',
                'UK': 'https://news.google.com/rss?hl=en-GB&gl=GB&ceid=GB:en',
                'FR': 'https://news.google.com/rss?hl=fr&gl=FR&ceid=FR:fr',
                'JP': 'https://news.google.com/rss?hl=ja&gl=JP&ceid=JP:ja'
            };
            const fallbackUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rss_urls[state.region] || rss_urls['WW'])}`;
            let response = await fetch(fallbackUrl);
            if (response.ok) {
                let data = await response.json();
                if (data.items && data.items.length > 0) {
                    processData(data.items);
                    document.getElementById('last-sync-time').innerText = new Date().toLocaleTimeString() + " [FALLBACK]";
                    state.failCount = 0;
                    return;
                }
            }
        } catch (e) { console.error("Fallback sync failed", e); }

        state.failCount++;
        document.getElementById('last-sync-time').innerText = "OFFLINE";
        document.getElementById('retry-overlay').classList.remove('hidden');
    }

    function processData(items) {
        state.news = items.map((n, i) => {
            const title = n.title || "UNDEFINED_SIGNAL";
            const keywords = extractKeywords(title);
            const cat = getCategory(title);

            const catMap = { 'CYBER':'hacker', 'BIO':'medical', 'TECH':'technology', 'FINANCE':'market', 'GLOBAL':'world' };
            const terms = [...keywords, catMap[cat] || 'cyberpunk'].join(',');

            return {
                id: i,
                title: title,
                link: n.link || n.guid || "#",
                rawDate: n.pubDate,
                date: n.pubDate ? new Date(n.pubDate).toLocaleDateString() : new Date().toLocaleDateString(),
                region: n.source || state.region,
                cat: cat,
                sentiment: (Math.random() * 2 - 1).toFixed(2),
                entities: keywords.map(k => ({ text: k.toUpperCase(), type: Math.random() > 0.5 ? 'ORGA' : 'LOC' })),
                img: `https://loremflickr.com/800/600/${terms}/all?lock=${i}`,
                content: n.description || n.content || "",
                verified: Math.random() > 0.3,
                integrity: Math.floor(Math.random() * 40) + 60,
                keywords: keywords
            };
        });
        renderAll();
        updateSectorAnalysis();

        // Breaking check
        const breaking = items.slice(0, 10).find(n => {
            const t = (n.title || "").toUpperCase();
            return t.includes('BREAKING') || t.includes('EILMELDUNG') || t.includes('URGENT');
        });
        if (breaking) {
            const newsObj = state.news.find(x => x.title === breaking.title);
            if (newsObj) showAlert(newsObj);
        }
    }

    function renderAll() {
        renderFeed('main-feed', state.news);
        renderFeed('archive-feed', state.news);
        renderTimeline();
        document.getElementById('global-ticker').innerHTML = state.news.map(n => `<span class="ticker-item">${escapeHTML(n.title)}</span>`).join('');
        renderHotspots();
    }

    function renderFeed(id, items) {
        const container = document.getElementById(id);
        if (!container) return;
        const d = i18n[state.lang];
        container.innerHTML = items.slice(0, 30).map(n => {
            let sig = "SIG_ERR";
            try { sig = btoa(unescape(encodeURIComponent(n.title))).substring(0, 8).toUpperCase(); } catch(e){}
            return `
                <div class="glass-panel news-card" onclick="openDetail(${n.id})">
                    <img src="${n.img}" class="news-thumb" loading="lazy" onerror="this.src='https://picsum.photos/seed/${n.id}/800/600?blur=2'">
                    <div class="card-body">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span class="card-cat">${escapeHTML(n.cat)} // ${escapeHTML(n.region)}</span>
                            <div class="${n.verified ? 'badge-verified' : 'badge-unverified'}">
                                ${n.verified ? d['verified'] : d['unverified']}
                            </div>
                        </div>
                        <h4 class="card-title">${escapeHTML(n.title)}</h4>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:12px;">
                            <div style="font-size:0.55rem; color:var(--text-muted); opacity:0.6;">${sig}</div>
                            <div style="font-size:0.55rem; color:var(--text-muted);">${escapeHTML(n.date)}</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');

        if (typeof gsap !== 'undefined') {
            gsap.from('#' + id + ' .news-card', { opacity: 0, y: 10, duration: 0.05, stagger: 0.01, ease: "power2.out" });
        }
    }

    /* --- VIEW FLOW --- */
    function navTo(v) {
        if (state.activeView === v) return;
        const old = document.getElementById('view-' + state.activeView);
        const target = document.getElementById('view-' + v);
        const glitch = document.getElementById('global-glitch');

        if (typeof gsap !== 'undefined') {
            gsap.fromTo(glitch, { opacity: 0.2 }, { opacity: 0, duration: 0.05 });
            gsap.to(old, { opacity: 0, y: 5, duration: 0.05, onComplete: () => {
                old.classList.add('hidden');
                target.classList.remove('hidden');
                gsap.fromTo(target, { opacity: 0, y: -5 }, { opacity: 1, y: 0, duration: 0.05 });
            }});
        } else {
            old.classList.add('hidden');
            target.classList.remove('hidden');
        }

        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        const navBtn = document.getElementById('nav-' + v);
        if (navBtn) navBtn.classList.add('active');
        state.activeView = v;
        window.scrollTo(0, 0);

        const d = i18n[state.lang];
        if (v === 'grid') scrambleText('txt-grid-title', d['grid-title']);
        if (v === 'time') scrambleText('txt-time-title', d['time-title']);
        if (v === 'data') scrambleText('txt-data-title', d['data-title']);
    }

    function openDetail(id) {
        const n = state.news.find(x => x.id === id);
        if (!n) return;
        const d = i18n[state.lang];

        document.getElementById('det-img').style.backgroundImage = `url(${n.img})`;
        scrambleText('det-title', n.title);
        document.getElementById('det-content').innerHTML = n.content;

        const uplinks = document.getElementById('media-uplinks-container');
        uplinks.innerHTML = '';
        const searchTerms = [...n.keywords, n.cat.toLowerCase()].join(',');
        for(let i=0; i<3; i++) {
            const img = document.createElement('img');
            img.src = `https://loremflickr.com/320/240/${searchTerms}/all?lock=${n.id + i + 10}`;
            img.onerror = function() { this.src=`https://picsum.photos/seed/${n.id+i}/320/240?grayscale`; };
            img.style.width = '100%';
            img.style.height = '60px';
            img.style.objectFit = 'cover';
            img.style.borderRadius = '4px';
            img.style.border = '1px solid rgba(255,255,255,0.1)';
            img.style.opacity = '0.6';
            uplinks.appendChild(img);
        }

        const analysis = `SENTIMENT: ${n.sentiment} // ENTITIES: ${n.entities.length}\nPolarity suggests high-density ${n.cat} fluctuation in the ${n.region} sector. Source integrity: ${n.integrity}%.`;
        scrambleText('det-analysis', analysis);

        document.getElementById('det-entities').innerHTML = n.entities.map(e => `<span class="glow-badge" style="border-color:var(--primary); color:var(--highlight);">${escapeHTML(e.text)} [${escapeHTML(e.type)}]</span>`).join('');
        document.getElementById('det-cat').innerText = `${n.cat} // ${n.region}`;
        document.getElementById('det-link').href = n.link;
        document.getElementById('det-verified').innerHTML = `<div class="${n.verified ? 'badge-verified' : 'badge-unverified'}">${n.verified ? d['verified'] : d['unverified']}</div>`;

        navTo('detail');

        const bar = document.getElementById('integrity-fill');
        const val = document.getElementById('integrity-val');
        if (typeof gsap !== 'undefined') {
            gsap.set(bar, { width: "0%" });
            gsap.to(bar, { width: n.integrity + "%", duration: 0.5, ease: "power2.out" });
            let counter = { val: 0 };
            gsap.to(counter, { val: n.integrity, duration: 0.5, onUpdate: () => {
                val.innerText = Math.floor(counter.val) + "%";
            }});
        } else {
            bar.style.width = n.integrity + "%";
            val.innerText = n.integrity + "%";
        }
    }

    /* --- SHARED LOGIC (STUBS FOR BREVITY) --- */
    function showAlert(news) {
        const modal = document.getElementById('alert-breaking');
        if (!modal || !modal.classList.contains('hidden')) return;
        document.getElementById('alert-title').innerText = news.title;
        document.getElementById('alert-btn-view').onclick = () => { closeAlert(); openDetail(news.id); };
        modal.classList.remove('hidden');
        if (typeof gsap !== 'undefined') gsap.fromTo(modal.querySelector('.modal-content'), { scale: 0.8, opacity: 0, y: 20 }, { scale: 1, opacity: 1, y: 0, duration: 0.15, ease: "power2.out" });
    }
    function closeAlert() {
        const modal = document.getElementById('alert-breaking');
        if (typeof gsap !== 'undefined') gsap.to(modal.querySelector('.modal-content'), { scale: 0.9, opacity: 0, duration: 0.1, onComplete: () => modal.classList.add('hidden') });
        else modal.classList.add('hidden');
    }
    function extractKeywords(t) {
        const stops = new Set(['the','and','for','with','this','that','from','google','news','video','says','after','watch','breaking', 'report', 'investigators', 'find', 'update', 'latest', 'news', 'google', 'more', 'about', 'warns', 'warn', 'agree', 'shows', 'will', 'first', 'year', 'could', 'should', 'would']);
        return (t.split(' - ')[0] || "").toLowerCase().replace(/[^\w\s]/g,' ').split(/\s+/).filter(w => w.length > 3 && !stops.has(w)).slice(0,3);
    }
    function getCategory(title) {
        const t = (title || "").toLowerCase();
        if (/(cyber|hack|security|leak|malware|ransomware|breach|exploit|firewall)/i.test(t)) return 'CYBER';
        if (/(tech|ai|robot|digital|software|data|silicon|apple|google|microsoft|nvidia|tesla|musk|spacex|quantum|computing|smartphone|app)/i.test(t)) return 'TECH';
        if (/(climate|environment|bio|health|medical|virus|pandemic|dna|nature|green|energy|oil|gas|ocean|ecology|warming|solar|wind)/i.test(t)) return 'BIO';
        if (/(finance|market|stock|economy|trade|bank|crypto|bitcoin|price|dollar|euro|inflation|interest|fed|nasdaq|dow)/i.test(t)) return 'FINANCE';
        if (/(war|conflict|politics|election|government|china|russia|usa|un|world|crisis|summit|trump|biden|border|senate|parliament|nato)/i.test(t)) return 'GLOBAL';
        return 'INTEL';
    }
    function renderTimeline() {
        const c = document.getElementById('timeline-feed');
        c.innerHTML = state.news.map(n => `<div class="glass-panel timeline-node" onclick="openDetail(${n.id})"><div class="node-dot"></div><div style="font-size:0.7rem; color:var(--primary); margin-bottom:5px;">${escapeHTML(n.date)} // ${escapeHTML(n.cat)}</div><h4 style="margin:0; font-size:0.9rem; line-height:1.4;">${escapeHTML(n.title)}</h4></div>`).join('');
        const hours = new Array(24).fill(0);
        state.news.forEach(n => { const d = new Date(n.rawDate || Date.now()); if (!isNaN(d.getHours())) hours[d.getHours()]++; });
        const max = Math.max(...hours, 1);
        document.getElementById('time-density').innerHTML = hours.map(count => `<div style="flex:1; background:var(--primary); opacity:${count > 0 ? 0.8 : 0.1}; height:${Math.max((count/max)*100, 5)}%; border-radius:1px;"></div>`).join('');
    }
    function renderHotspots() {
        const c = document.getElementById('map-hotspots');
        if (!c) return; c.innerHTML = '';
        for(let i=0; i<8; i++) {
            const div = document.createElement('div'); div.className = 'hotspot'; div.style.left = (Math.random()*80 + 10) + '%'; div.style.top = (Math.random()*60 + 20) + '%';
            div.onmouseover = () => { document.getElementById('map-lat').innerText = (Math.random() * 180 - 90).toFixed(4); document.getElementById('map-lng').innerText = (Math.random() * 360 - 180).toFixed(4); };
            div.onclick = () => openDetail(Math.floor(Math.random()*state.news.length));
            c.appendChild(div);
        }
    }
    function updateSectorAnalysis() {
        const counts = {}; const entityCounts = {};
        state.news.forEach(n => { counts[n.cat] = (counts[n.cat] || 0) + 1; n.keywords.forEach(k => { const key = k.toUpperCase(); entityCounts[key] = (entityCounts[key] || 0) + 1; }); });
        const c = document.getElementById('sector-bars');
        c.innerHTML = Object.entries(counts).map(([cat, count]) => {
            const pct = (count / state.news.length) * 100;
            return `<div style="display:flex; align-items:center; gap:10px; font-size:0.55rem;"><div style="width:50px; color:var(--text-muted);">${escapeHTML(cat)}</div><div style="flex:1; height:3px; background:rgba(255,255,255,0.03); overflow:hidden;"><div class="sector-fill" style="height:100%; width:0%; background:var(--primary);" data-pct="${pct}"></div></div><div style="width:25px; text-align:right;">${Math.round(pct)}%</div></div>`;
        }).join('');
        if (typeof gsap !== 'undefined') gsap.to('.sector-fill', { width: (i, el) => el.dataset.pct + '%', duration: 0.5, ease: "power2.out", stagger: 0.05 });
        const ec = document.getElementById('entity-cloud');
        const sortedEntities = Object.entries(entityCounts).sort((a,b) => b[1] - a[1]);
        ec.innerHTML = sortedEntities.slice(0, 15).map(([e, count]) => {
            const maxCount = sortedEntities[0][1]; const size = 0.55 + (count / maxCount) * 0.35; const hue = getComputedStyle(document.documentElement).getPropertyValue('--primary-hue').trim();
            return `<span style="font-size:${size}rem; color:var(--accent); border:1px solid hsla(${hue}, 70%, 53%, 0.2); padding:2px 6px; border-radius:3px; white-space:nowrap;">${escapeHTML(e)}</span>`;
        }).join('');
    }
    function scrambleText(id, text) {
        const el = document.getElementById(id); if (!el) return;
        const chars = '!<>-_\\/[]{}—=+*^?#________'; let iteration = 0; if (el._scrambleInterval) clearInterval(el._scrambleInterval);
        el._scrambleInterval = setInterval(() => { el.textContent = text.split('').map((char, index) => { if (index < iteration) return text[index]; return chars[Math.floor(Math.random() * chars.length)]; }).join(''); if (iteration >= text.length) clearInterval(el._scrambleInterval); iteration += 1 / 3; }, 15);
    }
    function filterVault() { const q = document.getElementById('vault-search').value.toLowerCase(); const filtered = state.news.filter(n => n.title.toLowerCase().includes(q) || n.cat.toLowerCase().includes(q)); renderFeed('archive-feed', filtered); }
    function setRegion(r) { state.region = r; localStorage.setItem('nexus_reg', r); document.querySelectorAll('[id^="btn-"]').forEach(btn => btn.classList.remove('active')); const activeBtn = document.getElementById('btn-' + r.toLowerCase()); if (activeBtn) activeBtn.classList.add('active'); syncNews(); }
    function toggleFilters() { document.getElementById('modal-settings').classList.toggle('hidden'); }
    function filterByCategory(cat) { if (cat === 'ALL') renderFeed('main-feed', state.news); else renderFeed('main-feed', state.news.filter(n => n.cat === cat)); glitchFlash(); }
    function glitchFlash() { const g = document.getElementById('global-glitch'); if (typeof gsap !== 'undefined') gsap.fromTo(g, { opacity: 0.3 }, { opacity: 0, duration: 0.2 }); }
    function initNetwork() {
        const canvas = document.getElementById('network-canvas'); if (!canvas) return; const ctx = canvas.getContext('2d'); let dots = []; const count = 40;
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; dots = []; for(let i=0; i<count; i++) dots.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: (Math.random()-0.5)*0.5, vy: (Math.random()-0.5)*0.5 }); }
        function draw() { ctx.clearRect(0, 0, canvas.width, canvas.height); const hue = getComputedStyle(document.documentElement).getPropertyValue('--primary-hue').trim(); ctx.strokeStyle = `hsla(${hue}, 70%, 53%, 0.1)`; ctx.fillStyle = `hsla(${hue}, 70%, 53%, 0.2)`; dots.forEach((d, i) => { d.x += d.vx; d.y += d.vy; if(d.x < 0 || d.x > canvas.width) d.vx *= -1; if(d.y < 0 || d.y > canvas.height) d.vy *= -1; ctx.beginPath(); ctx.arc(d.x, d.y, 1, 0, Math.PI*2); ctx.fill(); for(let j=i+1; j<dots.length; j++) { const d2 = dots[j]; const dist = Math.hypot(d.x-d2.x, d.y-d2.y); if(dist < 150) { ctx.globalAlpha = 1 - (dist/150); ctx.beginPath(); ctx.moveTo(d.x, d.y); ctx.lineTo(d2.x, d2.y); ctx.stroke(); } } }); requestAnimationFrame(draw); }
        window.addEventListener('resize', resize); resize(); draw();
    }

    /* --- INITIALIZATION --- */
    window.onload = () => {
        // Safe Removal of Boot Loader
        const removeBoot = () => {
            const bl = document.getElementById('boot-loader');
            if (!bl) return;
            if (typeof gsap !== 'undefined') {
                gsap.to(bl, { opacity: 0, duration: 0.2, onComplete: () => bl.remove() });
            } else {
                bl.classList.add('auto-hide');
                setTimeout(() => bl.remove(), 1000);
            }
        };
        setTimeout(removeBoot, 5000); // Fail-safe 5s

        syncNews().finally(() => {
            // Success removal
            const log = document.getElementById('boot-log');
            if (log) {
                const d = document.createElement('div'); d.innerText = "> UPLINK_STABLE. READY."; log.appendChild(d);
                if (typeof gsap !== 'undefined') gsap.to('#boot-bar', { width: "100%", duration: 0.1, onComplete: removeBoot });
                else removeBoot();
            }
        });

        initNetwork();
        const env = document.getElementById('env-chart');
        if (env) env.innerHTML = Array.from({length: 40}).map(() => `<div style="flex:1; height:${Math.random()*100}%; background:var(--primary); opacity:0.3; border-radius:1px; transition: height 0.4s var(--ease-tech);"></div>`).join('');
        setInterval(() => {
            const up = document.getElementById('stat-uplink'); const lat = document.getElementById('stat-latency');
            const bwp = document.getElementById('bw-pct'); const stp = document.getElementById('st-pct');
            if (up) up.innerText = (Math.random() * 5 + 2).toFixed(1) + " TB/s";
            if (lat) lat.innerText = Math.floor(Math.random() * 20 + 5) + "ms";
            if (env) env.querySelectorAll('div').forEach(b => b.style.height = (Math.random()*100)+"%");
            if (bwp) bwp.innerText = (80 + Math.floor(Math.random()*15)) + "%";
            if (stp) stp.innerText = (95 + Math.floor(Math.random()*4)) + "%";
        }, 1000);
        applyL10n(); updateHue();
        document.addEventListener('click', (e) => { const el = e.target.closest('button, .news-card, .nav-item, .glow-badge'); if (el && typeof gsap !== 'undefined') gsap.to(el, { scale: 0.95, duration: 0.08, yoyo: true, repeat: 1 }); });
        setInterval(syncNews, 30 * 60 * 1000);
    };
</script>
</body>
</html>
